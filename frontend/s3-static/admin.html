<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CloudVault - Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style-v2.css">
</head>
<body>
  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="nav-left">
      <h1><i class="fas fa-crown" style="color: gold;"></i> CloudVault - Admin</h1>
    </div>
    <div class="nav-right">
      <div class="profile-dropdown">
        <button class="profile-btn" onclick="toggleProfileDropdown()">
          <i class="fas fa-user-circle"></i>
          <span id="username-display">Loading...</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" id="profileDropdown">
          <div class="dropdown-header">
            <div class="user-info">
              <strong id="profile-name">Admin</strong>
              <small id="profile-role">ADMINISTRATOR</small>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <a href="#" onclick="openChangePassword()"><i class="fas fa-key"></i> Change Password</a>
          <a href="#" onclick="openResetMFA()"><i class="fas fa-mobile-alt"></i> Reset MFA</a>
          <a href="#" onclick="toggleTheme()"><i class="fas fa-palette"></i> <span id="theme-text">Dark Theme</span></a>
          <div class="dropdown-divider"></div>
          <a href="#" onclick="logout()" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="main-container">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-item active" onclick="showSection('users')">
          <i class="fas fa-users"></i>
          <span>User Management</span>
        </div>
        <div class="sidebar-item" onclick="showSection('accounts')">
          <i class="fas fa-building"></i>
          <span>Accounts</span>
        </div>
        <div class="sidebar-item" onclick="showSection('buckets')">
          <i class="fas fa-bucket"></i>
          <span>Bucket Access</span>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- User Management Section -->
      <div class="admin-section" id="usersSection">
        <div class="section-header">
          <h2>User Management</h2>
          <button class="btn btn-primary" onclick="openCreateUserModal()">
            <i class="fas fa-plus"></i> Create User
          </button>
        </div>

        <div class="users-grid">
          <div class="user-card" onclick="openUserDetails('admin@local')">
            <div class="user-avatar">
              <i class="fas fa-crown"></i>
            </div>
            <div class="user-info">
              <h4>Admin User</h4>
              <p>admin@local</p>
              <span class="role-badge admin">Administrator</span>
            </div>
          </div>
          <!-- More user cards will be loaded here -->
        </div>
      </div>

      <!-- Accounts Section -->
      <div class="admin-section" id="accountsSection" style="display: none;">
        <div class="section-header">
          <h2>AWS Accounts</h2>
          <button class="btn btn-primary" onclick="openAddAccountModal()">
            <i class="fas fa-plus"></i> Add Account
          </button>
        </div>

        <div class="accounts-table">
          <table class="data-table">
            <thead>
              <tr>
                <th>Account ID</th>
                <th>Account Name</th>
                <th>Role ARN</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="accountsTableBody">
              <!-- Account data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Bucket Access Section -->
      <div class="admin-section" id="bucketsSection" style="display: none;">
        <div class="section-header">
          <h2>Bucket Access Management</h2>
          <button class="btn btn-primary" onclick="openGrantAccessModal()">
            <i class="fas fa-plus"></i> Grant Access
          </button>
        </div>

        <!-- S3 Bucket Access Control Form -->
        <div class="card" style="margin-bottom:30px;">
          <h3>Grant Bucket Access</h3>
          <p style="font-size:14px;color:#555;">Manage which users can access which S3 buckets and what actions they can perform.</p>

          <div style="margin-bottom:10px;">
            <label><b>User:</b></label>
            <select id="perm_user" style="margin-left:10px;padding:6px;border-radius:6px;"></select>
            <label style="margin-left:20px;"><b>Bucket:</b></label>
            <input id="perm_bucket" placeholder="bucket-name" style="padding:6px;border-radius:6px;width:200px;">
          </div>

          <div style="margin-bottom:10px;">
            <label><b>Access Level:</b></label>
            <select id="access_level" onchange="togglePrefixInput()" style="margin-left:10px;padding:6px;border-radius:6px;width:150px;">
              <option value="bucket">Entire Bucket</option>
              <option value="prefix">Specific Folder</option>
            </select>
            <input id="perm_prefix" placeholder="folder/path/" style="padding:6px;border-radius:6px;width:200px;margin-left:10px;display:none;">
          </div>

          <div style="margin-bottom:10px;">
            <label><input type="checkbox" id="perm_read"> Read</label>
            <label style="margin-left:15px;"><input type="checkbox" id="perm_upload"> Upload</label>
            <label style="margin-left:15px;"><input type="checkbox" id="perm_download"> Download</label>
            <label style="margin-left:15px;"><input type="checkbox" id="perm_delete"> Delete</label>
          </div>

          <button class="btn btn-primary" onclick="saveBucketPerms()" style="margin-top:10px;">Save Permissions</button>
          <div id="permMsg" style="margin-top:15px;font-weight:bold;"></div>
        </div>

        <div class="permissions-table">
          <table class="data-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Bucket</th>
                <th>Path</th>
                <th>Permissions</th>
                <th>Expires</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="permissionsTableBody">
              <!-- Permission data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Create User Modal -->
  <div class="modal" id="createUserModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New User</h3>
        <button class="close-btn" onclick="closeCreateUserModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="newUserEmail" class="form-input" placeholder="user@company.com">
        </div>
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="newUserName" class="form-input" placeholder="John Doe">
        </div>
        <div class="form-group">
          <label>Company</label>
          <input type="text" id="newUserCompany" class="form-input" placeholder="Company Name">
        </div>
        <div class="form-group">
          <label>Manager</label>
          <input type="text" id="newUserManager" class="form-input" placeholder="Manager Name">
        </div>
        <div class="form-group">
          <label>Role</label>
          <select id="newUserRole" class="form-input">
            <option value="readonly">Read Only</option>
            <option value="readwrite">Read & Write</option>
            <option value="admin">Administrator</option>
          </select>
        </div>
        <div class="form-group">
          <label>Temporary Password</label>
          <input type="password" id="newUserPassword" class="form-input" placeholder="Temporary password">
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeCreateUserModal()">Cancel</button>
          <button class="btn btn-primary" onclick="createUser()">Create User</button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Details Modal -->
  <div class="modal" id="userDetailsModal">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>User Details</h3>
        <button class="close-btn" onclick="closeUserDetailsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="user-details-grid">
          <div class="detail-section">
            <h4>Basic Information</h4>
            <div class="form-group">
              <label>Full Name</label>
              <input type="text" id="editUserName" class="form-input">
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="editUserEmail" class="form-input" readonly>
            </div>
            <div class="form-group">
              <label>Company</label>
              <input type="text" id="editUserCompany" class="form-input">
            </div>
            <div class="form-group">
              <label>Manager</label>
              <input type="text" id="editUserManager" class="form-input">
            </div>
            <div class="form-group">
              <label>Internal SPOC</label>
              <input type="text" id="editUserSpoc" class="form-input">
            </div>
            <div class="form-group">
              <label>Ticket Number</label>
              <input type="text" id="editUserTicket" class="form-input">
            </div>
          </div>
          
          <div class="detail-section">
            <h4>Access Control</h4>
            <div class="form-group">
              <label>Role</label>
              <select id="editUserRole" class="form-input">
                <option value="readonly">Read Only</option>
                <option value="readwrite">Read & Write</option>
                <option value="admin">Administrator</option>
              </select>
            </div>
            <div class="form-group">
              <label>Auto Revoke Date</label>
              <input type="date" id="editUserExpiry" class="form-input">
            </div>
            <div class="form-group">
              <label>Status</label>
              <select id="editUserStatus" class="form-input">
                <option value="active">Active</option>
                <option value="suspended">Suspended</option>
                <option value="expired">Expired</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Bucket Permissions Section -->
        <div class="detail-section" style="grid-column: 1 / -1; margin-top: 24px;">
          <h4>Bucket Permissions</h4>
          
          <!-- Add New Bucket Permission -->
          <div class="card" style="margin-bottom: 20px; padding: 16px;">
            <h5 style="margin-bottom: 12px; font-size: 14px;">Add Bucket Access</h5>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px;">
              <input id="userBucketName" placeholder="bucket-name" class="form-input" style="font-size: 13px; padding: 6px 8px;">
              <select id="userAccessLevel" onchange="toggleUserPrefixInput()" class="form-input" style="font-size: 13px; padding: 6px 8px;">
                <option value="bucket">Entire Bucket</option>
                <option value="prefix">Specific Folder</option>
              </select>
              <input id="userPrefixPath" placeholder="folder/path/" class="form-input" style="font-size: 13px; padding: 6px 8px; display: none;">
            </div>
            <div style="display: flex; gap: 16px; margin-bottom: 12px;">
              <label style="font-size: 13px;"><input type="checkbox" id="userCanRead"> Read</label>
              <label style="font-size: 13px;"><input type="checkbox" id="userCanUpload"> Upload</label>
              <label style="font-size: 13px;"><input type="checkbox" id="userCanDownload"> Download</label>
              <label style="font-size: 13px;"><input type="checkbox" id="userCanDelete"> Delete</label>
            </div>
            <button class="btn btn-primary" onclick="addUserBucketPermission()" style="font-size: 13px; padding: 6px 12px;">Add Permission</button>
            <div id="userPermMsg" style="margin-top: 8px; font-size: 12px;"></div>
          </div>
          
          <!-- Current Permissions Table -->
          <div style="max-height: 200px; overflow-y: auto;">
            <table class="data-table" style="font-size: 13px;">
              <thead>
                <tr>
                  <th>Bucket</th>
                  <th>Path</th>
                  <th>Permissions</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="userPermissionsTable">
                <!-- User permissions will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-danger" onclick="deleteUser()">Delete User</button>
          <button class="btn btn-warning" onclick="resetUserMFA()">Reset MFA</button>
          <button class="btn btn-secondary" onclick="closeUserDetailsModal()">Cancel</button>
          <button class="btn btn-primary" onclick="updateUser()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script src="interface-v2.js"></script>
  <script src="admin-v2.js"></script>
  <script src="prefix-permissions.js"></script>
</body>
</html>