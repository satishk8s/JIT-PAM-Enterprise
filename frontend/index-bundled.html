<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="#0B1220">
    <title>NPAMX</title>
    <script>
        (function() {
            var t = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', t);
        })();
        // API URL - MUST be set before databases.js loads (it loads before app.js)
        (function() {
            var port = window.location.port || '';
            if (port === '80' || port === '443' || port === '') {
                window.API_BASE = window.location.origin + '/api';
            } else {
                window.API_BASE = window.location.protocol + '//' + window.location.hostname + ':5000/api';
            }
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preload" href="bundle.css?v=15" as="style">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" crossorigin>
    <link href="bundle.css?v=15" rel="stylesheet">
</head>
<body class="performance-mode">
    <script>
    (function(){ if (localStorage.getItem('isLoggedIn') !== 'true') document.body.classList.add('login-page'); })();
    </script>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <!-- Default: Email/OTP Login -->
            <div id="emailOTPView">
                <div class="login-header">
                    <h2>NPAMX</h2>
                    <p>Sign in to access the admin dashboard and management.</p>
                </div>
                
                <form id="emailOTPForm" class="login-form" onsubmit="handleEmailOTPContinue(); return false;">
                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="emailOTP" placeholder="Enter Email" required>
                        <small class="input-hint">Please enter a username or email</small>
                    </div>
                    <button type="button" class="btn-primary" onclick="handleEmailOTPContinue()">Continue</button>
                </form>
                
                <div class="divider">
                    <span>Or</span>
                </div>
                
                <div class="alt-login-options">
                    <button class="alt-login-btn" onclick="showSSOLogin()">Login with SSO</button>
                    <button class="alt-login-btn" onclick="showUsernamePasswordLogin()">Login with Password</button>
                    <button class="alt-login-btn" onclick="quickLoginAsUser('user@nykaa.com')" style="margin-top: 8px; font-size: 12px; opacity: 0.9;" title="One-click login for testing common user view">Test as Common User (user@nykaa.com)</button>
                </div>
            </div>

            <!-- Password Login -->
            <div id="passwordLoginView" style="display: none;">
                <button class="back-btn" onclick="showDefaultLogin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="login-header">
                    <h2>Login with Password</h2>
                    <p>Enter your credentials to access your account.</p>
                </div>
                
                <form id="usernamePasswordForm" class="login-form">
                    <div class="form-group">
                        <label>Email or Username <span class="required">*</span></label>
                        <input type="text" id="username" placeholder="Enter Email or Username" required>
                    </div>
                    <div class="form-group">
                        <label>Password <span class="required">*</span></label>
                        <input type="password" id="password" placeholder="Enter Password" required>
                    </div>
                    <button type="submit" class="btn-primary">Continue</button>
                </form>
                
                <div class="login-links">
                    <a href="#" onclick="alert('Password reset coming soon')">Forgot Password?</a>
                </div>
            </div>

            <!-- OTP Verification -->
            <div id="otpVerifyView" style="display: none;">
                <button class="back-btn" onclick="showDefaultLogin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="otp-header">
                    <i class="fas fa-mobile-alt"></i>
                    <h3>Verify One-Time Passcode</h3>
                    <p>Enter the 6-digit code sent to <strong id="otpEmail"></strong></p>
                </div>
                
                <form id="otpVerifyForm" class="login-form" onsubmit="return false;">
                    <div class="otp-inputs">
                        <input type="text" maxlength="1" class="otp-input" id="otp1">
                        <input type="text" maxlength="1" class="otp-input" id="otp2">
                        <input type="text" maxlength="1" class="otp-input" id="otp3">
                        <input type="text" maxlength="1" class="otp-input" id="otp4">
                        <input type="text" maxlength="1" class="otp-input" id="otp5">
                        <input type="text" maxlength="1" class="otp-input" id="otp6">
                    </div>
                    <small class="input-hint" style="display: block; margin-top: 8px; color: var(--text-secondary);">Demo: enter or paste 123456</small>
                    <button type="button" class="btn-primary" id="otpVerifyBtn">Verify & Continue</button>
                </form>
                <script>
                (function(){
                    function doOTPLogin(){
                        var e=(sessionStorage.getItem('otp_email')||(document.getElementById('emailOTP')&&document.getElementById('emailOTP').value)||'').trim();
                        if(!e){alert('Session expired. Go back and enter email again.');return;}
                        var o='';for(var i=1;i<=6;i++){var x=document.getElementById('otp'+i);o+=x?x.value:'';}
                        if(o.length!==6){alert('Please enter all 6 digits. Demo: 123456');return;}
                        sessionStorage.removeItem('otp_email');
                        var admins=['admin@nykaa.com','satish.korra@nykaa.com','satish@nykaa.com','security@nykaa.com'];
                        var isA=admins.indexOf(e.toLowerCase())>=0;
                        localStorage.setItem('isLoggedIn','true');
                        localStorage.setItem('userEmail',e);
                        localStorage.setItem('userName',e.split('@')[0].replace(/\./g,' '));
                        localStorage.setItem('isAdmin',isA?'true':'false');
                        localStorage.setItem('userRole',isA?'admin':'user');
                        var lp=document.getElementById('loginPage'),ma=document.getElementById('mainApp');
                        if(lp)lp.style.display='none';
                        if(ma)ma.style.display='block';
                        document.body.classList.remove('login-page');
                        if(typeof showMainApp==='function')showMainApp();
                    }
                    var btn=document.getElementById('otpVerifyBtn');
                    if(btn)btn.onclick=doOTPLogin;
                    window.verifyOTPAndLogin=doOTPLogin;
                })();
                </script>
                
                <div class="login-links">
                    <a href="#" onclick="alert('âœ… OTP resent')">Resend Code</a>
                </div>
            </div>

            <!-- MFA Verification -->
            <div id="mfaView" style="display: none;">
                <button class="back-btn" onclick="showUsernamePasswordLogin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="mfa-header">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Two-Factor Authentication</h3>
                    <p>Open your authenticator app to get your verification code</p>
                </div>
                
                <form id="mfaForm" class="login-form">
                    <div class="form-group">
                        <label>Authentication Code <span class="required">*</span></label>
                        <input type="text" id="mfaCode" placeholder="Enter 6-digit code" maxlength="6" required class="mfa-input">
                    </div>
                    <button type="submit" class="btn-primary">Verify & Sign In</button>
                </form>
                
                <div class="login-links">
                    <a href="#" onclick="alert('MFA help coming soon')">Having trouble?</a>
                </div>
            </div>
            <div class="login-footer" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center;">
                <a href="user-login.html" style="color: var(--text-secondary); font-size: 13px;">User? Request access here</a>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">NPAMX</h1>
                <button class="btn-secondary" onclick="refreshRequests()" style="margin-left: 1rem;" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="header-right">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-glow-btn" onclick="alert('ðŸ“š Documentation\n\nKnowledge base articles and user guides are under construction.\n\nComing soon!')" style="margin-right: 0.5rem;">
                    <i class="fas fa-book"></i> Documentation
                </button>
                <button class="header-glow-btn" onclick="alert('ðŸ†˜ Support\n\nSupport portal is under construction.\n\nFor immediate assistance, contact:\nadmin@company.com')" style="margin-right: 0.5rem;">
                    <i class="fas fa-life-ring"></i> Support
                </button>
                <button class="header-glow-btn admin-only-nav" id="adminPanelBtn" onclick="showPage('admin')" style="margin-right: 1rem;">
                    <i class="fas fa-shield-alt"></i> Admin Panel
                </button>
                <div class="profile-dropdown">
                    <button class="profile-btn" onclick="toggleProfileMenu()">
                        <i class="fas fa-user-circle"></i>
                        <span id="userName">Satish Korra</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div id="profileMenu" class="profile-menu">
                        <a href="#" onclick="showProfile()"><i class="fas fa-user"></i> My Profile</a>
                        <a href="#" onclick="showPasswordReset()"><i class="fas fa-key"></i> Reset Password</a>
                        <a href="#" onclick="showMFAReset()"><i class="fas fa-shield-alt"></i> Reset MFA</a>
                        <a href="#" onclick="showManager()"><i class="fas fa-users"></i> My Manager</a>
                        <hr>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar Navigation -->
        <div class="app-layout">
            <aside class="sidebar" id="mainSidebar">
                <nav class="sidebar-nav">
                    <div class="nav-item active admin-only-nav" onclick="showPage('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </div>
                    
                    <div class="nav-category">Management</div>
                    <div class="nav-item" onclick="showPage('requests')">
                        <i class="fas fa-list-alt"></i>
                        <span>My Requests</span>
                    </div>
                    <div class="nav-item" onclick="showPage('workflow')">
                        <i class="fas fa-project-diagram"></i>
                        <span>Approval Workflows</span>
                    </div>
                    <div class="nav-item" onclick="showPage('sessions')">
                        <i class="fas fa-history"></i>
                        <span>Active Sessions</span>
                    </div>
                    
                    <div class="nav-category">Cloud Access</div>
                    <div class="nav-item" onclick="showPage('aws')">
                        <i class="fab fa-aws nav-icon-cloud nav-icon-aws"></i>
                        <span>AWS</span>
                    </div>
                    <div class="nav-item" onclick="showPage('gcp')">
                        <i class="fab fa-google nav-icon-cloud nav-icon-gcp"></i>
                        <span>GCP</span>
                    </div>
                    
                    <div class="nav-category">Workloads</div>
                    <div class="nav-item" onclick="showPage('instances')">
                        <i class="fab fa-aws nav-icon-workload nav-icon-aws"></i>
                        <span>EC2 Instances</span>
                    </div>
                    <div class="nav-item" onclick="showPage('gcpVms')">
                        <i class="fab fa-google nav-icon-workload nav-icon-gcp"></i>
                        <span>GCP VM's</span>
                    </div>
                    
                    <div class="nav-category">Storage</div>
                    <div class="nav-item" onclick="showPage('s3')">
                        <i class="fab fa-aws nav-icon-storage nav-icon-aws"></i>
                        <span>S3</span>
                    </div>
                    <div class="nav-item" onclick="showPage('gcs')">
                        <i class="fab fa-google nav-icon-storage nav-icon-gcp"></i>
                        <span>GCS</span>
                    </div>
                    
                    <div class="nav-category">Databases</div>
                    <div class="nav-item" onclick="showPage('databases')">
                        <i class="fas fa-database"></i>
                        <span>Databases</span>
                    </div>
                    
                    <div class="nav-category">Terminal</div>
                    <div class="nav-item" onclick="showPage('databaseTerminal')">
                        <i class="fas fa-database"></i>
                        <span>Database Terminal</span>
                    </div>
                    <div class="nav-item" onclick="showPage('vmTerminal')">
                        <i class="fas fa-server"></i>
                        <span>VM Terminal</span>
                    </div>
                    
                </nav>
                <div class="sidebar-toggle-edge" id="sidebarToggle" onclick="toggleSidebar(event)" title="Collapse sidebar">
                    <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
                    <span id="sidebarToggleLabel" class="sidebar-toggle-label">&lt;&lt;</span>
                </div>
            </aside>
            <div class="sidebar-expand-fab" id="sidebarExpandFab" onclick="toggleSidebar(event)" title="Show sidebar" style="display: none;">
                <i class="fas fa-bars"></i>
            </div>

            <!-- Main Content -->
            <main class="app-main">
            <!-- Dashboard Page (Merged: Main + Admin) -->
            <div id="dashboardPage" class="page active">
                <div class="page-content">
                    <div class="page-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                    </div>
                    
                    <!-- KPI Cards Row 1: JIT & Security -->
                    <div class="dashboard-kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-icon" style="background: rgba(56, 189, 248, 0.15); color: var(--primary);">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="activeSessionsCount">0</div>
                                <div class="kpi-label">Active Privileged Sessions</div>
                                <div class="kpi-trend"><i class="fas fa-arrow-up"></i> <span id="sessionsTrend">+12%</span></div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon" style="background: rgba(245, 158, 11, 0.15); color: var(--warning);">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="pendingApprovalsCount">0</div>
                                <div class="kpi-label">Pending JIT Approvals</div>
                                <div class="kpi-trend"><i class="fas fa-arrow-up"></i> <span id="pendingTrend">+5</span></div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon" style="background: rgba(239, 68, 68, 0.15); color: var(--danger);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="highRiskRequestsCount">0</div>
                                <div class="kpi-label">High-Risk Requests</div>
                                <div class="kpi-trend"><i class="fas fa-arrow-down"></i> <span id="riskTrend">-2</span></div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon" style="background: rgba(34, 197, 94, 0.15); color: var(--success);">
                                <i class="fas fa-shield-check"></i>
                            </div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="policyViolationsCount">0</div>
                                <div class="kpi-label">Policy Violations</div>
                                <div class="kpi-trend"><i class="fas fa-check"></i> <span>0</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPI Cards Row 2: User Analytics (Admin) -->
                    <div class="dashboard-admin-cards">
                        <div class="admin-kpi-card">
                            <div class="admin-kpi-icon"><i class="fas fa-user-plus"></i></div>
                            <div class="admin-kpi-content">
                                <h3 id="newUsersCount">0</h3>
                                <p>New Users (30 days)</p>
                            </div>
                        </div>
                        <div class="admin-kpi-card">
                            <div class="admin-kpi-icon"><i class="fas fa-user-check"></i></div>
                            <div class="admin-kpi-content">
                                <h3 id="repeatedUsersCount">0</h3>
                                <p>Repeated Users</p>
                            </div>
                        </div>
                        <div class="admin-kpi-card">
                            <div class="admin-kpi-icon"><i class="fas fa-user-shield"></i></div>
                            <div class="admin-kpi-content">
                                <h3 id="exceptionalUsersCount">0</h3>
                                <p>Exceptional Users</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="dashboard-charts-row">
                        <div class="dashboard-chart-card">
                            <h3><i class="fas fa-chart-line"></i> User Activity Trends</h3>
                            <div class="chart-container">
                                <canvas id="userActivityChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div class="dashboard-chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Request Types Distribution</h3>
                            <div class="chart-container">
                                <canvas id="requestTypesChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Panels Grid: Live Sessions, Recent Requests, AI Feed -->
                    <div class="dashboard-panels-grid">
                        <div class="dashboard-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-terminal"></i> Live Sessions</h3>
                                <button class="btn-secondary btn-sm" onclick="showPage('sessions')">
                                    View All <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div id="liveSessionsList" class="panel-content">
                                <p class="text-muted">No active sessions</p>
                            </div>
                        </div>
                        <div class="dashboard-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-clock"></i> Recent JIT Requests</h3>
                                <button class="btn-secondary btn-sm" onclick="showPage('requests')">
                                    View All <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div id="recentJITRequests" class="panel-content">
                                <p class="text-muted">No recent requests</p>
                            </div>
                        </div>
                        <div class="dashboard-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-brain" style="color: var(--ai-accent);"></i> NPAMX Decisions Feed</h3>
                                <button class="btn-secondary btn-sm" onclick="showPage('admin'); setTimeout(function(){ var b=document.querySelector('.admin-tab-btn[onclick*=\'security\']'); if(b) b.click(); }, 150);">
                                    View Engine <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div id="aiDecisionsFeed" class="panel-content">
                                <p class="text-muted">No AI decisions yet</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions (Admin) -->
                    <div class="dashboard-quick-actions">
                        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                        <div class="dashboard-action-buttons">
                            <button class="btn-secondary" onclick="exportAuditLog()">
                                <i class="fas fa-download"></i> Export Audit Log
                            </button>
                            <button class="btn-warning" onclick="cleanupOldRequests()">
                                <i class="fas fa-broom"></i> Cleanup Old Requests
                            </button>
                            <button class="btn-danger" onclick="revokeAllExpired()">
                                <i class="fas fa-times-circle"></i> Revoke All Expired
                            </button>
                        </div>
                    </div>
                </div>
            </div>
                    
            <!-- My Requests Page -->
            <div id="requestsPage" class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2><i class="fas fa-list-alt"></i> My Requests</h2>
                    </div>

                    <!-- Cloud Access Request -->
                    <div class="requests-category-card">
                        <h3 class="requests-category-title"><i class="fas fa-cloud"></i> Cloud Access Request</h3>
                        <div class="requests-status-buttons">
                            <button class="requests-status-btn requests-status-pending requests-status-glow" data-category="cloud" data-status="pending" onclick="filterRequestsByCategory('cloud', 'pending')"><i class="fas fa-clock"></i> Pending</button>
                            <button class="requests-status-btn requests-status-inprogress" data-category="cloud" data-status="in_progress" onclick="filterRequestsByCategory('cloud', 'in_progress')"><i class="fas fa-spinner"></i> In Progress</button>
                            <button class="requests-status-btn requests-status-completed" data-category="cloud" data-status="completed" onclick="filterRequestsByCategory('cloud', 'completed')"><i class="fas fa-check-circle"></i> Completed</button>
                            <button class="requests-status-btn requests-status-rejected" data-category="cloud" data-status="denied" onclick="filterRequestsByCategory('cloud', 'denied')"><i class="fas fa-times-circle"></i> Rejected</button>
                        </div>
                        <div class="jit-requests-grid" id="requestsGrid">
                            <!-- Cloud request cards loaded by loadRequestsPage() -->
                        </div>
                    </div>

                    <!-- Storage -->
                    <div class="requests-category-card">
                        <h3 class="requests-category-title"><i class="fas fa-hdd"></i> Storage</h3>
                        <div class="requests-status-buttons">
                            <button class="requests-status-btn requests-status-pending requests-status-glow" data-category="storage" data-status="pending" onclick="filterRequestsByCategory('storage', 'pending')"><i class="fas fa-clock"></i> Pending</button>
                            <button class="requests-status-btn requests-status-inprogress" data-category="storage" data-status="in_progress" onclick="filterRequestsByCategory('storage', 'in_progress')"><i class="fas fa-spinner"></i> In Progress</button>
                            <button class="requests-status-btn requests-status-completed" data-category="storage" data-status="completed" onclick="filterRequestsByCategory('storage', 'completed')"><i class="fas fa-check-circle"></i> Completed</button>
                            <button class="requests-status-btn requests-status-rejected" data-category="storage" data-status="rejected" onclick="filterRequestsByCategory('storage', 'rejected')"><i class="fas fa-times-circle"></i> Rejected</button>
                        </div>
                        <div id="storageRequestsList" class="requests-list">
                            <div class="requests-empty">No storage requests</div>
                        </div>
                    </div>

                    <!-- Databases -->
                    <div class="requests-category-card">
                        <h3 class="requests-category-title"><i class="fas fa-database"></i> Databases</h3>
                        <div class="requests-status-buttons">
                            <button class="requests-status-btn requests-status-pending requests-status-glow" data-category="databases" data-status="all" onclick="filterRequestsByCategory('databases', 'all')"><i class="fas fa-list"></i> All</button>
                            <button class="requests-status-btn requests-status-pending" data-category="databases" data-status="pending" onclick="filterRequestsByCategory('databases', 'pending')"><i class="fas fa-clock"></i> Pending</button>
                            <button class="requests-status-btn requests-status-inprogress" data-category="databases" data-status="in_progress" onclick="filterRequestsByCategory('databases', 'in_progress')"><i class="fas fa-spinner"></i> In Progress</button>
                            <button class="requests-status-btn requests-status-completed" data-category="databases" data-status="completed" onclick="filterRequestsByCategory('databases', 'completed')"><i class="fas fa-check-circle"></i> Completed</button>
                            <button class="requests-status-btn requests-status-rejected" data-category="databases" data-status="rejected" onclick="filterRequestsByCategory('databases', 'rejected')"><i class="fas fa-times-circle"></i> Rejected</button>
                        </div>
                        <div id="dbRequestsList" class="requests-list">
                            <div class="requests-empty">No database requests</div>
                        </div>
                    </div>

                    <!-- Workloads -->
                    <div class="requests-category-card">
                        <h3 class="requests-category-title"><i class="fas fa-server"></i> Workloads</h3>
                        <div class="requests-status-buttons">
                            <button class="requests-status-btn requests-status-pending requests-status-glow" data-category="workloads" data-status="pending" onclick="filterRequestsByCategory('workloads', 'pending')"><i class="fas fa-clock"></i> Pending</button>
                            <button class="requests-status-btn requests-status-inprogress" data-category="workloads" data-status="in_progress" onclick="filterRequestsByCategory('workloads', 'in_progress')"><i class="fas fa-spinner"></i> In Progress</button>
                            <button class="requests-status-btn requests-status-completed" data-category="workloads" data-status="completed" onclick="filterRequestsByCategory('workloads', 'completed')"><i class="fas fa-check-circle"></i> Completed</button>
                            <button class="requests-status-btn requests-status-rejected" data-category="workloads" data-status="rejected" onclick="filterRequestsByCategory('workloads', 'rejected')"><i class="fas fa-times-circle"></i> Rejected</button>
                        </div>
                        <div id="workloadsRequestsList" class="requests-list">
                            <div class="requests-empty">No workload requests</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cloud Access: AWS Page -->
            <div id="awsPage" class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2><img src="assets/logos/aws.png" alt="" class="page-title-logo"> AWS Access Request</h2>
                    </div>
                    <div class="cloud-access-choice-section">
                        <h3>Request access for</h3>
                        <div class="cloud-access-choice-cards">
                            <div class="cloud-access-choice-card" onclick="startNewRequestForCloud('aws', 'myself')">
                                <i class="fas fa-user"></i>
                                <h4>Request for Myself</h4>
                                <p>Request AWS access for your own use</p>
                            </div>
                            <div class="cloud-access-choice-card" onclick="startNewRequestForCloud('aws', 'others')">
                                <i class="fas fa-user-plus"></i>
                                <h4>Request for Others</h4>
                                <p>Request AWS access on behalf of others</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cloud Access: GCP Page -->
            <div id="gcpPage" class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2><img src="assets/logos/gcp.png" alt="" class="page-title-logo"> GCP Access Request</h2>
                    </div>
                    <div class="cloud-access-choice-section">
                        <h3>Request access for</h3>
                        <div class="cloud-access-choice-cards">
                            <div class="cloud-access-choice-card" onclick="startNewRequestForCloud('gcp', 'myself')">
                                <i class="fas fa-user"></i>
                                <h4>Request for Myself</h4>
                                <p>Request GCP access for your own use</p>
                            </div>
                            <div class="cloud-access-choice-card" onclick="startNewRequestForCloud('gcp', 'others')">
                                <i class="fas fa-user-plus"></i>
                                <h4>Request for Others</h4>
                                <p>Request GCP access on behalf of others</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generated Policy Page -->
            <div id="policyPage" class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2><i class="fas fa-file-code"></i> Generated Policy</h2>
                    </div>
                    <div id="policyContent" style="padding: 20px;">
                        <p style="color: var(--text-muted); text-align: center; padding: 40px;">
                            <i class="fas fa-file-code" style="font-size: 3rem; display: block; margin-bottom: 15px; opacity: 0.5;"></i>
                            No policy generated yet. Use NPAMX to generate permissions.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Approval Workflows Page (Visual Flow Designer) -->
            <div id="workflowPage" class="page">
                <div class="page-content">
                    <div class="page-header">
                        <h2><i class="fas fa-project-diagram"></i> Approval Workflows</h2>
                        <div class="page-header-actions">
                            <button class="btn-secondary" onclick="clearWorkflow()">
                                <i class="fas fa-trash"></i> Clear
                                    </button>
                            <button class="btn-secondary" onclick="validateWorkflow()">
                                <i class="fas fa-check-circle"></i> Validate
                                    </button>
                            <button class="btn-primary" onclick="saveWorkflow()">
                                <i class="fas fa-save"></i> Save Workflow
                                    </button>
                        </div>
                    </div>
                    
                    <!-- Three-Panel Layout -->
                    <div class="workflow-designer-container">
                        <!-- Left Panel: Component Palette -->
                        <div class="workflow-palette">
                            <div class="palette-header">
                                <h3>Components</h3>
                            </div>
                            <div class="palette-content">
                                <div class="palette-category">
                                    <div class="palette-category-header" onclick="togglePaletteCategory('flow-control')">
                                        <i class="fas fa-chevron-down"></i>
                                        <span>Flow Control</span>
                                    </div>
                                    <div class="palette-category-items" id="flow-control-items">
                                        <div class="palette-item" draggable="true" data-type="start" data-color="blue">
                                            <i class="fas fa-play-circle"></i>
                                            <span>Start</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="end" data-color="blue">
                                            <i class="fas fa-stop-circle"></i>
                                            <span>End</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="palette-category">
                                    <div class="palette-category-header" onclick="togglePaletteCategory('environments')">
                                        <i class="fas fa-chevron-down"></i>
                                        <span>Environments</span>
                                    </div>
                                    <div class="palette-category-items" id="environments-items">
                                        <div class="palette-item" draggable="true" data-type="environment" data-env="production" data-color="gray">
                                            <i class="fas fa-server"></i>
                                            <span>Production</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="environment" data-env="nonprod" data-color="gray">
                                            <i class="fas fa-server"></i>
                                            <span>Non-Production</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="environment" data-env="sandbox" data-color="gray">
                                            <i class="fas fa-server"></i>
                                            <span>Sandbox</span>
                                        </div>
                            </div>
                        </div>
                        
                                <div class="palette-category">
                                    <div class="palette-category-header" onclick="togglePaletteCategory('approvers')">
                                        <i class="fas fa-chevron-down"></i>
                                        <span>Approver Roles</span>
                                </div>
                                    <div class="palette-category-items" id="approvers-items">
                                        <div class="palette-item" draggable="true" data-type="approver" data-role="manager" data-color="purple">
                                            <i class="fas fa-user-tie"></i>
                                            <span>Manager</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="approver" data-role="devops" data-color="purple">
                                            <i class="fas fa-tools"></i>
                                            <span>DevOps Lead</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="approver" data-role="security" data-color="purple">
                                            <i class="fas fa-shield-alt"></i>
                                            <span>Security Lead</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="approver" data-role="admin" data-color="purple">
                                            <i class="fas fa-user-shield"></i>
                                            <span>Platform Admin</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="approver" data-role="ai" data-color="purple">
                                            <i class="fas fa-robot"></i>
                                            <span>AI Auto-Approval</span>
                                        </div>
                            </div>
                        </div>
                        
                                <div class="palette-category">
                                    <div class="palette-category-header" onclick="togglePaletteCategory('controls')">
                                        <i class="fas fa-chevron-down"></i>
                                        <span>Flow Controls</span>
                                    </div>
                                    <div class="palette-category-items" id="controls-items">
                                        <div class="palette-item" draggable="true" data-type="conditional" data-color="orange">
                                            <i class="fas fa-code-branch"></i>
                                            <span>Conditional</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="parallel" data-color="orange">
                                            <i class="fas fa-stream"></i>
                                            <span>Parallel Approval</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="timeout" data-color="orange">
                                            <i class="fas fa-clock"></i>
                                            <span>Timeout / Expiry</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="palette-category">
                                    <div class="palette-category-header" onclick="togglePaletteCategory('outcomes')">
                                        <i class="fas fa-chevron-down"></i>
                                        <span>Outcomes</span>
                                    </div>
                                    <div class="palette-category-items" id="outcomes-items">
                                        <div class="palette-item" draggable="true" data-type="granted" data-color="green">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Access Granted</span>
                                        </div>
                                        <div class="palette-item" draggable="true" data-type="denied" data-color="red">
                                            <i class="fas fa-times-circle"></i>
                                            <span>Access Denied</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Center Canvas: Visual Flow Designer -->
                        <div class="workflow-canvas-container">
                            <div class="canvas-toolbar">
                                <button class="btn-secondary btn-sm" onclick="zoomIn()">
                                    <i class="fas fa-search-plus"></i>
                                    </button>
                                <button class="btn-secondary btn-sm" onclick="zoomOut()">
                                    <i class="fas fa-search-minus"></i>
                                    </button>
                                <button class="btn-secondary btn-sm" onclick="resetZoom()">
                                    <i class="fas fa-expand"></i> Reset
                                    </button>
                                <div class="canvas-info">
                                    <span id="canvasNodeCount">0 nodes</span>
                                </div>
                            </div>
                            <div class="workflow-canvas" id="workflowCanvas">
                                <div class="canvas-grid"></div>
                                <svg class="canvas-connections" id="canvasConnections"></svg>
                                <div class="canvas-nodes" id="canvasNodes">
                                    <!-- Nodes will be added here via drag & drop -->
                            </div>
                        </div>
                    </div>
                    
                        <!-- Right Panel: Properties -->
                        <div class="workflow-properties">
                            <div class="properties-header">
                                <h3>Properties</h3>
                </div>
                            <div class="properties-content" id="propertiesContent">
                                <div class="properties-empty">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <p>Select a node to configure</p>
            </div>
                </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Troubleshooting Page -->
            <div id="troubleshootPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-tools"></i> Troubleshooting with AI</h2>
                </div>
                <div style="padding: 20px;">
                    <div style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 30px; text-align: center;">
                        <i class="fas fa-robot" style="font-size: 4rem; color: #667eea; margin-bottom: 20px; display: block;"></i>
                        <h3 style="margin: 0 0 10px 0; color: var(--text-primary);">NPAMX-Powered Troubleshooting</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Get help from AI when you encounter access errors or permission issues</p>
                        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-top: 20px;">
                            <strong>ðŸš§ Coming Soon</strong><br>
                            <span style="font-size: 14px;">This feature will allow you to paste error messages and get NPAMX-powered solutions</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Request Page -->
            <div id="newRequestPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-plus"></i> New Access Request</h2>
                    <button class="btn-secondary" onclick="cancelNewRequest()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
                
                <!-- Step 1: What do you want to request? -->
                <div id="requestStep1" class="request-wizard-step">
                    <h3 style="font-family: 'Inter', sans-serif; font-size: 18px; margin-bottom: 20px; color: var(--text-primary);">What do you want to request access for?</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 800px;">
                        <div class="cloud-choice-card" onclick="selectCloudProvider('aws')">
                            <img src="assets/logos/aws.png" alt="AWS" class="card-logo">
                            <h4>AWS</h4>
                        </div>
                        <div class="cloud-choice-card" onclick="selectCloudProvider('gcp')">
                            <img src="assets/logos/gcp.png" alt="GCP" class="card-logo">
                            <h4>GCP</h4>
                        </div>
                    </div>
                </div>

                <!-- Step 2: AWS Flow -->
                <div id="requestStep2AWS" class="request-wizard-step" style="display: none;">
                    <button class="btn-secondary" onclick="backToStep1()" style="margin-bottom: 20px;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    
                    <div style="display: flex; gap: 20px;">
                        <form id="newRequestForm" style="flex: 0 0 450px; max-width: 450px;">
                            <div class="form-group">
                                <label>Select AWS Account *</label>
                                <select id="requestAccount" required onchange="loadPermissionSetsDropdown()">
                                    <option value="">Select Account</option>
                                </select>
                            </div>

                            <div class="form-group" id="permissionSetsGroup" style="display: none;">
                                <label>Access Type</label>
                                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                    <button type="button" class="btn-secondary" id="existingPermSetBtn" onclick="showAccessType('existing')" style="flex: 1;">
                                        Existing Permission Set
                                    </button>
                                    <button type="button" class="btn-secondary" id="customAccessBtn" onclick="showAccessType('custom')" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                                        Custom Access (AI)
                                    </button>
                                </div>
                                
                                <div id="existingPermSetSection" style="display: none;">
                                    <label>Select Permission Set</label>
                                    <select id="requestPermissionSet" onchange="handlePermissionSetSelection()">
                                        <option value="">Select a permission set</option>
                                    </select>
                                </div>
                            </div>

                            <div id="resourceExplorerSection" style="display: none;">
                                <div class="form-group">
                                    <label>Available AWS Services</label>
                                    <div id="resourceExplorerLoading" style="display: none; text-align: center; padding: 20px;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #667eea;"></i>
                                        <p style="margin-top: 10px; color: var(--text-secondary); font-size: 14px;">Fetching resources from AWS...</p>
                                    </div>
                                    <div id="awsServicesList" style="display: none;"></div>
                                </div>

                                <div class="form-group" id="myResourcesSection" style="display: none;">
                                    <label>My Resources</label>
                                    <div id="myResourcesList" class="resources-list"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Duration</label>
                                <select id="requestDuration">
                                    <option value="4">4 hours</option>
                                    <option value="8" selected>8 hours</option>
                                    <option value="24">24 hours</option>
                                    <option value="72">3 days</option>
                                    <option value="120">5 days (max)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Business Justification *</label>
                                <textarea id="requestJustification" placeholder="Explain why you need this access" rows="3" required></textarea>
                            </div>

                            <!-- AI Copilot Section -->
                            <div id="aiCopilotSection" style="display: none; margin-top: 20px; padding: 20px; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="margin: 0; font-size: 15px; color: var(--text-primary); font-family: 'Inter', sans-serif; font-weight: 600;">
                                        <i class="fas fa-brain" style="color: #667eea;"></i> NPAMX
                                    </h4>
                                    <div style="display: flex; gap: 8px;">
                                        <button onclick="saveRequestDraft()" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" title="Save current request as draft">
                                            <i class="fas fa-save"></i> Save Draft
                                        </button>
                                        <button onclick="loadRequestDrafts()" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" title="Load saved drafts">
                                            <i class="fas fa-folder-open"></i> Load Drafts
                                        </button>
                                    </div>
                                </div>
                                <div id="aiChatArea" style="display: none; max-height: 300px; overflow-y: auto; margin-bottom: 15px; padding: 15px; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border-color);"></div>
                                <div style="display: flex; gap: 10px; align-items: flex-end;">
                                    <textarea id="aiCopilotUseCase" placeholder="Type your message..." rows="1" style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 14px; background: var(--bg-primary); color: var(--text-primary); resize: none;"></textarea>
                                    <button type="button" id="chatWithAIBtn" class="btn-primary" onclick="chatWithAI()" style="padding: 12px 20px; font-size: 14px; border-radius: 8px;">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                                <button type="button" id="generatePermissionsBtn" class="btn-primary" onclick="generateAICopilotPermissions()" style="margin-top: 15px; font-size: 14px; display: none; width: 100%; padding: 12px; border-radius: 8px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                    <i class="fas fa-check-circle"></i> Generate Permissions
                                </button>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="button" class="btn-secondary" onclick="cancelNewRequest()">Cancel</button>
                                <button type="submit" class="btn-primary">Submit Request</button>
                            </div>
                        </form>
                        
                        <div style="flex: 0 0 280px;">
                            <div style="position: sticky; top: 20px; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--text-primary); font-family: 'Inter', sans-serif; font-weight: 600;">Selected Resources</h4>
                                <div id="selectedResourcesPanel" style="max-height: 400px; overflow-y: auto;">
                                    <p style="color: var(--text-secondary); font-size: 12px;">No resources selected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cloud Accounts Page -->
            <div id="accountsPage" class="page">
                <div class="page-header">
                    <h2><img src="assets/logos/aws.png" alt="" class="page-title-logo"> Cloud Accounts</h2>
                </div>
                <div class="cloud-providers">
                    <div class="cloud-provider-card">
                        <button class="cloud-provider-btn" onclick="toggleCloudProvider('aws')">
                            <img src="assets/logos/aws.png" alt="" class="nav-logo">
                            <span>AWS Accounts</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </button>
                        <div id="awsAccounts" class="cloud-accounts-list" style="display: none;">
                            <div id="awsAccountsGrid" class="accounts-grid">
                                <!-- AWS accounts will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="cloud-provider-card">
                        <button class="cloud-provider-btn" onclick="toggleCloudProvider('gcp')">
                            <img src="assets/logos/gcp.png" alt="" class="nav-logo">
                            <span>GCP Projects</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </button>
                        <div id="gcpProjects" class="cloud-accounts-list" style="display: none;">
                            <div class="coming-soon-small">
                                <p>GCP integration coming soon</p>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- Applications Page -->
            <div id="applicationsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-apps"></i> Applications & Services</h2>
                    <button class="btn-primary" onclick="showNewAppRequestModal()">
                        <i class="fas fa-plus"></i> New Request
                    </button>
                </div>
                
                <div class="applications-grid">
                    <div class="app-category">
                        <h3><i class="fas fa-ticket-alt"></i> Ticketing Systems</h3>
                        <div class="app-cards">
                            <div class="app-card" onclick="requestAppAccess('jira')">
                                <div class="app-logo app-logo-jira">J</div>
                                <h4>JIRA</h4>
                                <p>Issue & Project Tracking</p>
                            </div>
                            <div class="app-card" onclick="requestAppAccess('splunk')">
                                <div class="app-logo app-logo-splunk">S</div>
                                <h4>Splunk</h4>
                                <p>Log Analysis & SIEM</p>
                            </div>
                            <div class="app-card" onclick="requestAppAccess('servicenow')">
                                <div class="app-logo app-logo-servicenow">SN</div>
                                <h4>ServiceNow</h4>
                                <p>IT Service Management</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Databases Page - Tree + AI + Status -->
            <div id="databasesPage" class="page">
                <div class="page-header">
                    <h2><img src="assets/logos/rds.png" alt="" class="page-title-logo"> Database Access (JIT)</h2>
                </div>
                <div class="page-content db-page-layout">
                    <!-- Top: Single info box with full description -->
                    <div class="db-page-info-banner">
                        <h3><i class="fas fa-shield-alt"></i> Database Access (Just-In-Time)</h3>
                        <p>This platform provides temporary, time-bound access to databases using Just-In-Time (JIT) controls. There is no permanent database access â€” request access only when required, and it expires automatically.</p>
                        <div class="db-info-sections">
                            <div class="db-info-section">
                                <h4>Default Access Role â€” Read-Only</h4>
                                <p>Permissions include: <strong>SELECT</strong>, <strong>EXPLAIN</strong></p>
                                <p class="db-info-flow"><strong>Approval flow:</strong> Non-Production: Automatically approved â€” Production: Manager approval required</p>
                            </div>
                            <div class="db-info-section">
                                <h4>Custom Access Roles</h4>
                                <p>If you need permissions beyond read-only, use <strong>NPAMX AI</strong> to describe your requirement in plain language. The system will generate a least-privilege role for your task.</p>
                                <p class="db-info-flow"><strong>Approval flow:</strong> Non-Production: Manager approval â€” Production: Manager and CISO approval</p>
                            </div>
                        </div>
                        <p class="db-info-footer">All access remains time-bound and is revoked automatically after expiry. <strong>Select the database engine below</strong> to begin your access request.</p>
                    </div>
                    <!-- Layout: Tree (left) + Config/AI (right) -->
                    <div class="db-page-body">
                        <div class="db-left-panel">
                            <div class="db-tree-card">
                                <h3><i class="fas fa-sitemap"></i> Database Engines</h3>
                                <div id="dbTreeContainer" class="db-tree"></div>
                            </div>
                        </div>
                        <div class="db-right-panel">
                            <div id="dbStepPanel" class="db-step-panel db-step-hidden">
                                <div class="db-step-header">
                                    <h3><i class="fas fa-cog"></i> <span id="dbStepTitle">Configure</span></h3>
                                    <button class="btn-icon" onclick="closeDbStepPanel()" title="Back"><i class="fas fa-times"></i></button>
                                </div>
                                <div id="dbStepContent" class="db-step-content"></div>
                                <div class="db-step-actions">
                                    <button class="btn-primary" id="dbStepNextBtn" onclick="dbStepNext()"><i class="fas fa-arrow-right"></i> Next</button>
                                </div>
                            </div>
                            <div id="dbAiPanel" class="db-ai-panel db-ai-panel-hidden">
                                <div class="db-ai-header">
                                    <h3><i class="fas fa-robot"></i> NPAMX â€” <span id="dbAiEngineLabel">Select an engine</span></h3>
                                    <button class="btn-icon" onclick="closeDbAiPanel()" title="Close"><i class="fas fa-times"></i></button>
                                </div>
                                <div id="dbAiChat" class="db-ai-chat"></div>
                                <div id="dbAiThinking" class="db-ai-thinking" style="display: none;">
                                    <div class="db-ai-thinking-dots"><span></span><span></span><span></span></div>
                                    <span>NPAMX is thinking...</span>
                                </div>
                                <div id="dbAiQuickPrompts" class="db-ai-quick-prompts" style="display: none;"></div>
                                <div class="db-ai-input-row">
                                    <input type="text" id="dbAiInput" placeholder="Type your message or describe custom permissions..." onkeypress="if(event.key==='Enter') sendDbAiMessage()">
                                    <button class="btn-primary" onclick="sendDbAiMessage()"><i class="fas fa-paper-plane"></i></button>
                                </div>
                                <div id="dbAiRequestSummary" class="db-ai-summary" style="display: none;"></div>
                                <div id="dbAiActions" class="db-ai-actions" style="display: none;">
                                    <button class="btn-secondary" onclick="editDbRequestDuration()"><i class="fas fa-edit"></i> Edit Duration</button>
                                    <button class="btn-primary" onclick="submitDbRequestViaAi()"><i class="fas fa-check-circle"></i> Submit for Approval</button>
                                </div>
                            </div>
                        <!-- Approved + Query Terminal -->
                        <div class="db-section card">
                            <h3><i class="fas fa-check-circle"></i> My Approved Databases</h3>
                            <table class="instances-table">
                                <thead>
                                    <tr>
                                        <th>Engine</th>
                                        <th>Endpoint</th>
                                        <th>Username</th>
                                        <th>Role</th>
                                        <th>Expires</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedDatabasesTableBody">
                                    <tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">No approved databases</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Connect to Terminal: available from My Approved Databases row after approval -->
                    </div>
                </div>
            </div>
            </div>

            <!-- DB Error Popup (RDS list failures) -->
            <div id="dbErrorPopup" class="db-error-popup">
                <div class="db-error-popup-backdrop" onclick="hideDbErrorPopup()"></div>
                <div class="db-error-popup-box">
                    <div class="db-error-popup-header">
                        <span class="db-error-emoji">&#128577;</span>
                        <h3>Unable to List RDS Instances</h3>
                        <button class="btn-icon" onclick="hideDbErrorPopup()" title="Close"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="db-error-popup-body">
                        <p class="db-error-msg">â€”</p>
                        <h4>How to fix:</h4>
                        <ol class="db-error-instructions"></ol>
                    </div>
                </div>
            </div>

            <!-- S3 Explorer Page -->
            <div id="s3Page" class="page">
                <div class="page-header">
                    <h2><i class="fab fa-aws page-title-icon page-title-icon-aws"></i> S3 Explorer</h2>
                    <button class="btn-secondary" onclick="loadS3Buckets()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                
                <!-- Buckets List View -->
                <div id="s3BucketsList">
                    <div id="s3BucketsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px;">
                        <p style="color: #999; text-align: center; padding: 40px;">Loading buckets...</p>
                    </div>
                </div>
                
                <!-- Bucket Content View -->
                <div id="s3BucketContent" style="display: none;">
                    <div id="s3Breadcrumb" style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px;"></div>
                    
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <button class="btn-primary" id="s3UploadBtn" style="display: none;"><i class="fas fa-upload"></i> Upload</button>
                        <button class="btn-secondary" id="s3DownloadBtn" onclick="downloadS3Selected()" disabled><i class="fas fa-download"></i> Download</button>
                        <button class="btn-danger" id="s3DeleteBtn" onclick="deleteS3Selected()" disabled><i class="fas fa-trash"></i> Delete</button>
                        <button class="btn-secondary" onclick="refreshS3Bucket()" style="margin-left: auto;"><i class="fas fa-sync"></i> Refresh</button>
                    </div>
                    
                    <table class="instances-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="s3SelectAll" onchange="toggleS3SelectAll()"></th>
                                <th>Name</th>
                                <th style="width: 120px;">Size</th>
                                <th style="width: 180px;">Last Modified</th>
                                <th style="width: 100px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="s3FileTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #999;">No files</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- GCS Page -->
            <div id="gcsPage" class="page">
                <div class="page-header">
                    <h2><i class="fab fa-google page-title-icon page-title-icon-gcp"></i> Google Cloud Storage</h2>
                </div>
                <div class="coming-soon">
                    <i class="fab fa-google" style="font-size: 4rem; color: #4285F4; margin-bottom: 1rem;"></i>
                    <h3>GCS Integration Coming Soon</h3>
                    <p>Access Google Cloud Storage buckets</p>
                </div>
            </div>

            <!-- Integrations Page -->
            <div id="integrationsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-plug"></i> Integrations</h2>
                </div>
                <div class="integration-tabs">
                    <button class="integration-tab-btn active" onclick="showIntegrationTab('cloud')"><i class="fas fa-cloud"></i> Cloud</button>
                    <button class="integration-tab-btn" onclick="showIntegrationTab('identity')"><i class="fas fa-key"></i> Identity & Login</button>
                    <button class="integration-tab-btn" onclick="showIntegrationTab('siem')"><i class="fas fa-shield-halved"></i> SIEM</button>
                    <button class="integration-tab-btn" onclick="showIntegrationTab('ticketing')"><i class="fas fa-ticket-alt"></i> Ticketing</button>
                </div>
                
                <!-- Cloud Tab -->
                <div id="cloudIntegrationTab" class="integration-tab-content active">
                    <div class="integrations-grid">
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-aws"><i class="fab fa-aws"></i></div>
                            <h3>AWS</h3>
                            <button class="btn-primary" onclick="configureIntegration('aws')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-gcp"><i class="fab fa-google"></i></div>
                            <h3>GCP</h3>
                            <button class="btn-primary" onclick="configureIntegration('gcp')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                    </div>
                </div>
                
                <!-- Identity & Login Tab -->
                <div id="identityIntegrationTab" class="integration-tab-content">
                    <div class="integrations-grid">
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-okta"><i class="fas fa-key"></i></div>
                            <h3>Okta</h3>
                            <button class="btn-primary" onclick="configureIntegration('okta')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-jumpcloud"><i class="fas fa-user-shield"></i></div>
                            <h3>JumpCloud</h3>
                            <button class="btn-primary" onclick="configureIntegration('jumpcloud')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-onelogin"><i class="fas fa-sign-in-alt"></i></div>
                            <h3>OneLogin</h3>
                            <button class="btn-primary" onclick="configureIntegration('onelogin')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-azuread"><i class="fab fa-microsoft"></i></div>
                            <h3>Azure AD</h3>
                            <button class="btn-primary" onclick="configureIntegration('azuread')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-google"><i class="fab fa-google"></i></div>
                            <h3>Google Workspace</h3>
                            <button class="btn-primary" onclick="configureIntegration('googleworkspace')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-ping"><i class="fas fa-fingerprint"></i></div>
                            <h3>Ping Identity</h3>
                            <button class="btn-primary" onclick="configureIntegration('pingidentity')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-auth0"><i class="fas fa-lock"></i></div>
                            <h3>Auth0</h3>
                            <button class="btn-primary" onclick="configureIntegration('auth0')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-duo"><i class="fas fa-shield-alt"></i></div>
                            <h3>Duo Security</h3>
                            <button class="btn-primary" onclick="configureIntegration('duo')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                    </div>
                </div>
                
                <!-- SIEM Tab -->
                <div id="siemIntegrationTab" class="integration-tab-content">
                    <div class="integrations-grid">
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-splunk"><i class="fas fa-chart-line"></i></div>
                            <h3>Splunk</h3>
                            <button class="btn-primary" onclick="configureIntegration('splunk')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-sentinel"><i class="fab fa-microsoft"></i></div>
                            <h3>Microsoft Sentinel</h3>
                            <button class="btn-primary" onclick="configureIntegration('sentinel')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-chronicle"><i class="fab fa-google"></i></div>
                            <h3>Google Chronicle</h3>
                            <button class="btn-primary" onclick="configureIntegration('chronicle')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-qradar"><i class="fas fa-shield-halved"></i></div>
                            <h3>IBM QRadar</h3>
                            <button class="btn-primary" onclick="configureIntegration('qradar')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-elastic"><i class="fas fa-magnifying-glass"></i></div>
                            <h3>Elastic Security</h3>
                            <button class="btn-primary" onclick="configureIntegration('elastic')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-datadog"><i class="fas fa-chart-area"></i></div>
                            <h3>Datadog</h3>
                            <button class="btn-primary" onclick="configureIntegration('datadog')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-wazuh"><i class="fas fa-shield-virus"></i></div>
                            <h3>Wazuh</h3>
                            <button class="btn-primary" onclick="configureIntegration('wazuh')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-crowdstrike"><i class="fas fa-shield-halved"></i></div>
                            <h3>CrowdStrike</h3>
                            <button class="btn-primary" onclick="configureIntegration('crowdstrike')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                    </div>
                </div>
                
                <!-- Ticketing Tab -->
                <div id="ticketingIntegrationTab" class="integration-tab-content">
                    <div class="integrations-grid">
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-jira"><i class="fab fa-jira"></i></div>
                            <h3>Jira</h3>
                            <button class="btn-primary" onclick="configureIntegration('jira')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-servicenow"><i class="fas fa-cogs"></i></div>
                            <h3>ServiceNow</h3>
                            <button class="btn-primary" onclick="configureIntegration('servicenow')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-zendesk"><i class="fas fa-headset"></i></div>
                            <h3>Zendesk</h3>
                            <button class="btn-primary" onclick="configureIntegration('zendesk')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-freshdesk"><i class="fas fa-life-ring"></i></div>
                            <h3>Freshdesk</h3>
                            <button class="btn-primary" onclick="configureIntegration('freshdesk')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-pagerduty"><i class="fas fa-bell"></i></div>
                            <h3>PagerDuty</h3>
                            <button class="btn-primary" onclick="configureIntegration('pagerduty')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-opsgenie"><i class="fas fa-bolt"></i></div>
                            <h3>Opsgenie</h3>
                            <button class="btn-primary" onclick="configureIntegration('opsgenie')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                        <div class="integration-card">
                            <div class="integration-card-icon integration-logo-slack"><i class="fab fa-slack"></i></div>
                            <h3>Slack</h3>
                            <button class="btn-primary" onclick="configureIntegration('slack')"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reportsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-chart-bar" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>Access Reports & Analytics</h3>
                    <p>View detailed reports and analytics on access patterns</p>
                </div>
            </div>

            <!-- Database Terminal Page -->
            <div id="databaseTerminalPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-database"></i> Database Terminal</h2>
                    <button class="btn-secondary" onclick="refreshDatabaseTerminalPage()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                <div class="terminal-page-layout">
                    <aside class="terminal-sidebar">
                        <div class="terminal-category open" id="databaseTerminalDbCategory">
                            <div class="terminal-category-header open" onclick="toggleTerminalCategory('db', 'database')">
                                <i class="fas fa-database"></i>
                                <span>Approved Database Connections</span>
                                <i class="fas fa-chevron-down terminal-cat-chevron"></i>
                            </div>
                            <div class="terminal-category-list" id="databaseTerminalDbConnectionsList">
                                <div class="terminal-empty-state" id="databaseTerminalDbEmptyState">
                                    <i class="fas fa-database"></i>
                                    <p>No database access</p>
                                    <small>Request access from Databases page</small>
                                </div>
                                <div class="terminal-list-items" id="databaseTerminalDbListItems" style="display: none;"></div>
                            </div>
                        </div>
                    </aside>
                    <main class="terminal-main">
                        <div class="terminal-placeholder" id="databaseTerminalPlaceholder">
                            <div class="terminal-placeholder-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <h3>Select a database connection</h3>
                            <p>Choose a database from the left panel and click <strong>Connect</strong>. You can open multiple SQL tabs.</p>
                        </div>
                        <div class="terminal-active" id="databaseTerminalActive" style="display: none;">
                            <div class="terminal-tabs-bar" id="databaseTerminalTabsBar"></div>
                            <div class="terminal-tabs-content" id="databaseTerminalTabsContent"></div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- VM Terminal Page -->
            <div id="vmTerminalPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-server"></i> VM Terminal</h2>
                    <button class="btn-secondary" onclick="refreshVmTerminalPage()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                <div class="terminal-page-layout">
                    <aside class="terminal-sidebar">
                        <div class="terminal-category open" id="vmTerminalVmCategory">
                            <div class="terminal-category-header open" onclick="toggleTerminalCategory('vm', 'vm')">
                                <i class="fas fa-server"></i>
                                <span>Approved VM Connections</span>
                                <i class="fas fa-chevron-down terminal-cat-chevron"></i>
                            </div>
                            <div class="terminal-category-list" id="vmTerminalVmConnectionsList">
                                <div class="terminal-empty-state" id="vmTerminalVmEmptyState">
                                    <i class="fas fa-server"></i>
                                    <p>No VM access</p>
                                    <small>Request access from EC2 Instances</small>
                                </div>
                                <div class="terminal-list-items" id="vmTerminalVmListItems" style="display: none;"></div>
                            </div>
                        </div>
                    </aside>
                    <main class="terminal-main">
                        <div class="terminal-placeholder" id="vmTerminalPlaceholder">
                            <div class="terminal-placeholder-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <h3>Select a VM connection</h3>
                            <p>Choose a VM from the left panel and click <strong>Connect</strong> for Session Manager or SSH terminal options.</p>
                        </div>
                        <div class="terminal-active" id="vmTerminalActive" style="display: none;">
                            <div class="terminal-tabs-bar" id="vmTerminalTabsBar"></div>
                            <div class="terminal-tabs-content" id="vmTerminalTabsContent"></div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- Instances (EC2) Page -->
            <div id="instancesPage" class="page">
                <div class="page-header">
                    <h2><img src="assets/logos/aws.png" alt="" class="page-title-logo"> EC2 Instances</h2>
                    <button class="btn-primary btn-sm" id="requestAccessBtn" onclick="showInstanceAccessModal()" style="padding: 8px 16px; font-size: 13px;">
                        <i class="fas fa-key"></i> Request Access
                    </button>
                </div>
                <div class="instances-container">
                    <div class="instances-filters" style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                        <div>
                            <label style="margin-right: 10px; font-weight: 600;">Account:</label>
                            <select id="instanceAccountSelect" onchange="loadInstancesByAccount()" style="padding: 8px; min-width: 300px;">
                                <option value="">-- Select Account --</option>
                            </select>
                        </div>
                        <div>
                            <label style="margin-right: 10px; font-weight: 600;">State:</label>
                            <select id="instanceStateFilter" onchange="filterByState()" style="padding: 8px;">
                                <option value="">All</option>
                                <option value="running">Running</option>
                                <option value="stopped">Stopped</option>
                            </select>
                        </div>
                    </div>
                    <table class="instances-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="selectAllInstances" onchange="toggleSelectAll()"></th>
                                <th>Instance ID</th>
                                <th>Name</th>
                                <th>Private IP</th>
                                <th>State</th>
                            </tr>
                        </thead>
                        <tbody id="instancesTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                                    <img src="assets/logos/aws.png" alt="" class="card-logo" style="display: block; margin-bottom: 10px;">
                                    Select an account to view instances
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- GCP VM's Page -->
            <div id="gcpVmsPage" class="page">
                <div class="page-header">
                    <h2><i class="fab fa-google" style="color: #4285F4;"></i> GCP VM's</h2>
                </div>
                <div class="coming-soon">
                    <i class="fab fa-google" style="font-size: 4rem; color: #4285F4; margin-bottom: 1rem;"></i>
                    <h3>Google Compute Engine VM's</h3>
                    <p>Request JIT access to GCP Compute Engine instances</p>
                </div>
            </div>

            <!-- On-prem Servers Page -->
            <div id="onpremServersPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-server"></i> On-prem Servers</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-server" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>On-Premises Servers</h3>
                    <p>Request JIT access to on-premises servers and bare metal</p>
                </div>
            </div>

            <!-- Container Access Page -->
            <div id="containersPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-cube"></i> Container Access</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-cube" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>Kubernetes & Docker Access</h3>
                    <p>Access Kubernetes pods and Docker containers with temporary credentials</p>
                </div>
            </div>

            <!-- Secrets Manager Page -->
            <div id="secretsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-key"></i> Secrets Manager</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-key" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>Secrets & Credentials</h3>
                    <p>Manage and access secrets securely</p>
                </div>
            </div>

            <!-- Active Sessions Page -->
            <div id="sessionsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-history"></i> Active Sessions</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-history" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>Active Access Sessions</h3>
                    <p>Monitor and manage currently active access sessions</p>
                </div>
            </div>

            <!-- Audit Logs Page -->
            <div id="auditPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-clipboard-list"></i> Audit Logs</h2>
                </div>
                <div class="coming-soon">
                    <i class="fas fa-clipboard-list" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                    <h3>Comprehensive Audit Trail</h3>
                    <p>View complete audit logs of all access activities</p>
                </div>
            </div>

            <!-- Admin Panel Page (Dashboard moved to main page) -->
            <div id="adminPage" class="page">
                <div class="page-header" style="margin-bottom: 1.5rem;">
                    <div class="admin-nav">
                        <button class="admin-tab-btn active" onclick="showAdminTab('users', event)">
                            <i class="fas fa-users"></i> Users & Groups
                        </button>
                        <button class="admin-tab-btn" onclick="showAdminTab('policies', event)">
                            <i class="fas fa-cogs"></i> Management
                        </button>
                        <button class="admin-tab-btn" onclick="showAdminTab('features', event)">
                            <i class="fas fa-toggle-on"></i> Features
                        </button>
                        <button class="admin-tab-btn" onclick="showAdminTab('security', event)">
                            <i class="fas fa-shield-alt"></i> Security
                        </button>
                        <button class="admin-tab-btn" onclick="showAdminTab('integrations', event)">
                            <i class="fas fa-plug"></i> Integrations
                        </button>
                        <button class="admin-tab-btn" onclick="showAdminTab('reports', event)">
                            <i class="fas fa-chart-bar"></i> Reports & Audit
                        </button>
                    </div>
                </div>
                
                <!-- Admin Users & Groups Tab -->
                <div id="adminUsersTab" class="admin-tab" style="font-family: 'Inter', sans-serif;">
                    <!-- Top Ribbon: Add User & Add Group -->
                    <div class="user-mgmt-ribbon">
                        <button class="user-mgmt-glow-btn" onclick="showCreateUserModal()">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                        <button class="user-mgmt-glow-btn" onclick="showCreateGroupModal()">
                            <i class="fas fa-users-cog"></i> Assign to Group
                        </button>
                    </div>
                    
                    <!-- Sub-tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
                        <button class="user-mgmt-subtab user-mgmt-subtab-active" id="usersSubTab" onclick="showUsersSubTab('users')">
                            <i class="fas fa-user"></i> Users
                        </button>
                        <button class="user-mgmt-subtab" id="groupsSubTab" onclick="showUsersSubTab('groups')">
                            <i class="fas fa-users-cog"></i> Groups
                        </button>
                    </div>

                    <!-- Users Section -->
                    <div id="usersSection">
                        <div class="users-management">
                            <div class="users-header">
                                <h3>User Management</h3>
                            </div>
                            
                            <div class="users-table">
                            <table>
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Department</th>
                                        <th>Group</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                    <tr>
                                        <td>Satish Korra</td>
                                        <td>satish.korra@nykaa.com</td>
                                        <td>+91-9876543210</td>
                                        <td>DevOps</td>
                                        <td>DevOps Team</td>
                                        <td><span class="badge badge-danger">Admin</span></td>
                                        <td><span class="badge badge-success">Active</span></td>
                                        <td>
                                            <div class="user-mgmt-actions">
                                                <button class="user-mgmt-glow-btn btn-sm" onclick="editUser('satish')">Edit</button>
                                                <button class="user-mgmt-glow-btn btn-sm" onclick="deleteUser('satish')">Delete</button>
                                            </div>
                                        </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Groups Section (Access groups: ReadOnly, Manager, Admin) -->
                    <div id="groupsSection" style="display: none;">
                        <div class="groups-management">
                            <div class="section-header">
                                <h3>Access Groups</h3>
                                <p class="section-desc">Groups that define who can access the JIT tool and at what level. Same as roles.</p>
                            </div>
                            <div class="groups-list">
                                <div class="group-detail-card">
                                    <div class="group-detail-header">
                                        <h4>ReadOnly</h4>
                                        <div class="user-mgmt-actions">
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="editAccessGroup('ReadOnly')">Edit</button>
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="deleteAccessGroup('ReadOnly')">Delete</button>
                                        </div>
                                    </div>
                                    <div class="group-permissions">
                                        <p class="group-desc">Users can access the JIT console with read access.</p>
                                        <p class="group-members"><strong>Members:</strong> <span id="readonlyGroupCount">0</span> users</p>
                                    </div>
                                </div>
                                <div class="group-detail-card">
                                    <div class="group-detail-header">
                                        <h4>Manager</h4>
                                        <div class="user-mgmt-actions">
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="editAccessGroup('Manager')">Edit</button>
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="deleteAccessGroup('Manager')">Delete</button>
                                        </div>
                                    </div>
                                    <div class="group-permissions">
                                        <p class="group-desc">Integrations with cloud, create users and groups, download reports.</p>
                                        <p class="group-members"><strong>Members:</strong> <span id="managerGroupCount">0</span> users</p>
                                    </div>
                                </div>
                                <div class="group-detail-card">
                                    <div class="group-detail-header">
                                        <h4>Admin</h4>
                                        <div class="user-mgmt-actions">
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="editAccessGroup('Admin')">Edit</button>
                                            <button class="user-mgmt-glow-btn btn-sm" onclick="deleteAccessGroup('Admin')">Delete</button>
                                        </div>
                                    </div>
                                    <div class="group-permissions">
                                        <p class="group-desc">All above and manage guardrails, policies and security inside the tool.</p>
                                        <p class="group-members"><strong>Members:</strong> <span id="adminGroupCount">0</span> users</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Management Tab -->
                <div id="adminPoliciesTab" class="admin-tab" style="display: none; font-family: 'Inter', sans-serif;">
                    <div id="policiesSection" style="font-family: 'Inter', sans-serif;">
                        <div class="policy-builder">
                        <div class="builder-header">
                            <h3>ðŸŽ¯ Organization Policy Builder</h3>
                            <p style="color: #666; font-size: 13px;">Configure your organization's access control model - Groups, Policies, JIT Flow, and Approval Workflows</p>
                    </div>

                        <!-- User & Group Sync Options -->
                        <div class="quick-start-section">
                            <h4>ðŸ‘¥ User & Group Management</h4>
                            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Choose how to manage users and groups in your organization</p>
                            <div class="template-cards">
                                <div class="template-card" onclick="showSyncFromAD()">
                                    <div class="template-icon">ðŸ”„</div>
                                    <h5>Sync from Active Directory</h5>
                                    <p>Import users and groups from AD</p>
                                    <ul>
                                        <li>Auto-sync users from AD</li>
                                        <li>Auto-sync groups from AD</li>
                                        <li>Scheduled sync (hourly/daily)</li>
                                    </ul>
                                    <button class="btn-primary btn-sm" style="margin-top: 10px;">Configure AD Sync</button>
                            </div>
                                <div class="template-card" onclick="showSyncFromIdentityCenter()">
                                    <div class="template-icon">â˜ï¸</div>
                                    <h5>Sync from AWS Identity Center</h5>
                                    <p>Import from AWS SSO Identity Store</p>
                                    <ul>
                                        <li>Auto-sync from Identity Center</li>
                                        <li>Sync permission sets</li>
                                        <li>Real-time sync</li>
                                    </ul>
                                    <button class="btn-primary btn-sm" style="margin-top: 10px;">Configure Identity Center Sync</button>
                                    </div>
                                <div class="template-card" onclick="showManualUserManagement()">
                                    <div class="template-icon">âœï¸</div>
                                    <h5>Manual Management</h5>
                                    <p>Create users/groups in JIT tool</p>
                                    <ul>
                                        <li>Create users manually</li>
                                        <li>Create groups manually</li>
                                        <li>Push to Identity Center/AD</li>
                                    </ul>
                                    <button class="btn-primary btn-sm" style="margin-top: 10px;">Manage Manually</button>
                                    </div>
                                </div>
                            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 6px;">
                                <strong>âš ï¸ Security Note:</strong> Only users synced from AD or Identity Center can access cloud resources. This ensures unauthorized users cannot gain access even if they're in the company.
                            </div>
                        </div>
                        
                        <!-- Step-by-Step Builder -->
                        <div class="builder-steps">
                            <div class="step-card active" id="step1">
                                <div class="step-header" onclick="toggleStep('step1')">
                                    <span class="step-number">1</span>
                                    <h4>Define Groups</h4>
                                    <span class="step-status">âœ“ Configured</span>
                            </div>
                                <div class="step-content">
                                    <button class="btn-primary btn-sm" onclick="showCreateGroupWizard()">+ Create Group</button>
                                    <table class="mini-table">
                                <thead>
                                            <tr>
                                                <th>Group Name</th>
                                                <th>Type</th>
                                                <th>Members</th>
                                                <th>Access Model</th>
                                                <th>Actions</th>
                                    </tr>
                                </thead>
                                        <tbody id="groupsListTable">
                                            <tr>
                                                <td><strong>DevOps Team</strong></td>
                                                <td><span class="badge badge-success">Permanent</span></td>
                                                <td>5 users</td>
                                                <td>Full Access (L3)</td>
                                                <td>
                                                    <button class="btn-link" onclick="editGroupConfig('devops')">Edit</button>
                                                    <button class="btn-link" onclick="deleteGroupConfig('devops')">Delete</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><strong>Developers</strong></td>
                                                <td><span class="badge badge-warning">JIT Only</span></td>
                                                <td>45 users</td>
                                                <td>Limited Write (L2)</td>
                                                <td>
                                                    <button class="btn-link" onclick="editGroupConfig('developers')">Edit</button>
                                                    <button class="btn-link" onclick="deleteGroupConfig('developers')">Delete</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><strong>Security Team</strong></td>
                                                <td><span class="badge badge-success">Permanent</span></td>
                                                <td>3 users</td>
                                                <td>Read-Only (L1)</td>
                                                <td>
                                                    <button class="btn-link" onclick="editGroupConfig('security')">Edit</button>
                                                    <button class="btn-link" onclick="deleteGroupConfig('security')">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                            <div class="step-card" id="step2">
                                <div class="step-header" onclick="toggleStep('step2')">
                                    <span class="step-number">2</span>
                                    <h4>Define Access Levels (L1/L2/L3 or Custom)</h4>
                                    <span class="step-status">âœ“ Configured</span>
                            </div>
                                <div class="step-content">
                                    <button class="btn-primary btn-sm" onclick="showCreateLevelModal()">+ Add Level</button>
                                    <div class="levels-grid">
                                        <div class="level-card">
                                            <div class="level-header">
                                                <h5>L1 - Read Only</h5>
                                                <button class="btn-link" onclick="editLevel('L1')">Edit</button>
                            </div>
                                            <div class="level-details">
                                                <p><strong>Allowed:</strong> Describe*, List*, Get*</p>
                                                <p><strong>Denied:</strong> *Delete*, *Create*, iam:*</p>
                                                <p><strong>Max Duration:</strong> 8 hours</p>
                                                <p><strong>Approval:</strong> Self</p>
                            </div>
                        </div>
                                        <div class="level-card">
                                            <div class="level-header">
                                                <h5>L2 - Limited Write</h5>
                                                <button class="btn-link" onclick="editLevel('L2')">Edit</button>
                    </div>
                                            <div class="level-details">
                                                <p><strong>Allowed:</strong> Start*, Stop*, PutObject, GetLogEvents</p>
                                                <p><strong>Denied:</strong> *Delete*, *Create*, iam:*</p>
                                                <p><strong>Max Duration:</strong> 4 hours</p>
                                                <p><strong>Approval:</strong> Manager</p>
                            </div>
                        </div>
                                        <div class="level-card">
                                            <div class="level-header">
                                                <h5>L3 - Admin</h5>
                                                <button class="btn-link" onclick="editLevel('L3')">Edit</button>
                                        </div>
                                            <div class="level-details">
                                                <p><strong>Allowed:</strong> * (All)</p>
                                                <p><strong>Denied:</strong> iam:*, organizations:*</p>
                                                <p><strong>Max Duration:</strong> 2 hours</p>
                                                <p><strong>Approval:</strong> Manager + Security Lead</p>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>

                            <div class="step-card" id="step3">
                                <div class="step-header" onclick="toggleStep('step3')">
                                    <span class="step-number">3</span>
                                    <h4>Configure JIT Flow</h4>
                                    <span class="step-status">âš™ï¸ Configure</span>
                                        </div>
                                <div class="step-content">
                                    <div class="jit-config">
                                        <div class="config-row">
                                            <label><input type="checkbox" checked> Enable JIT for Production Accounts</label>
                                        </div>
                                        <div class="config-row">
                                            <label><input type="checkbox"> Enable JIT for Non-Production Accounts</label>
                                        </div>
                                        <div class="config-row">
                                            <label>Default JIT Duration:</label>
                                            <select style="padding: 5px;">
                                                <option>4 hours</option>
                                                <option selected>8 hours</option>
                                                <option>24 hours</option>
                                            </select>
                                        </div>
                                        <div class="config-row">
                                            <label>Max JIT Duration:</label>
                                            <select style="padding: 5px;">
                                                <option>24 hours</option>
                                                <option>72 hours</option>
                                                <option selected>120 hours (5 days)</option>
                                            </select>
                                        </div>
                                        <div class="config-row">
                                            <label><input type="checkbox" checked> Auto-revoke on expiry</label>
                                        </div>
                                        <div class="config-row">
                                            <label><input type="checkbox" checked> Send expiry reminders (1 hour before)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-card" id="step4">
                                <div class="step-header" onclick="toggleStep('step4')">
                                    <span class="step-number">4</span>
                                    <h4>Configure Approval Workflow</h4>
                                    <span class="step-status">âš™ï¸ Configure</span>
                                    </div>
                                <div class="step-content">
                                    <div class="workflow-builder">
                                        <h5>Approval Rules by Scenario</h5>
                                        <table class="mini-table">
                                            <thead>
                                                <tr>
                                                    <th>Scenario</th>
                                                    <th>Approvers</th>
                                                    <th>Timeout</th>
                                                    <th>Auto-Approve If</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Read-Only + Non-Prod</td>
                                                    <td>Self</td>
                                                    <td>Instant</td>
                                                    <td>Always</td>
                                                    <td><button class="btn-link" onclick="editApprovalRule('ro-nonprod')">Edit</button></td>
                                                </tr>
                                                <tr>
                                                    <td>Read-Only + Prod</td>
                                                    <td>Manager</td>
                                                    <td>4 hours</td>
                                                    <td>Duration < 8hrs</td>
                                                    <td><button class="btn-link" onclick="editApprovalRule('ro-prod')">Edit</button></td>
                                                </tr>
                                                <tr>
                                                    <td>Write + Non-Prod</td>
                                                    <td>Manager</td>
                                                    <td>2 hours</td>
                                                    <td>None</td>
                                                    <td><button class="btn-link" onclick="editApprovalRule('write-nonprod')">Edit</button></td>
                                                </tr>
                                                <tr>
                                                    <td>Write + Prod</td>
                                                    <td>Manager + Security Lead</td>
                                                    <td>1 hour</td>
                                                    <td>None</td>
                                                    <td><button class="btn-link" onclick="editApprovalRule('write-prod')">Edit</button></td>
                                                </tr>
                                                <tr>
                                                    <td>Admin Access</td>
                                                    <td>Manager + Security + CISO</td>
                                                    <td>30 mins</td>
                                                    <td>Never</td>
                                                    <td><button class="btn-link" onclick="editApprovalRule('admin')">Edit</button></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <button class="btn-primary btn-sm" style="margin-top: 10px;" onclick="addApprovalRule()">+ Add Custom Rule</button>
                                    </div>
                                </div>
                            </div>

                            <div class="step-card" id="step-accounts">
                                <div class="step-header" onclick="toggleStep('step-accounts')">
                                    <span class="step-number">5</span>
                                    <h4>Account Tagging</h4>
                                    <span class="step-status">âš™ï¸ Configure</span>
                                    </div>
                                <div class="step-content">
                                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Tag accounts with environment (prod/nonprod/sandbox) to control policy enforcement</p>
                                    <button class="btn-primary btn-sm" onclick="syncAccountsFromOU()" style="margin-bottom: 15px;">
                                        <i class="fas fa-sync"></i> Auto-Sync from AWS OU
                                    </button>
                                    <table class="mini-table">
                                        <thead>
                                            <tr>
                                                <th>Account ID</th>
                                                <th>Account Name</th>
                                                <th>Environment</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="accountsTaggingTable">
                                            <tr>
                                                <td colspan="4" style="text-align: center; padding: 20px;">Loading accounts...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="step-card" id="step-delete">
                                <div class="step-header" onclick="toggleStep('step-delete')">
                                    <span class="step-number">6</span>
                                    <h4>Restricted Actions Control</h4>
                                    <span class="step-status">âš™ï¸ Configure</span>
                                    </div>
                                <div class="step-content">
                                    <div class="delete-config-modern">
                                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">Delete & Destructive Actions</h4>
                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Non-Production Environments</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowDeleteNonProd" onchange="updateDeletePolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Allow delete operations on dev/staging resources</p>
                                        </div>

                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Production Environment</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowDeleteProd" onchange="updateDeletePolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Requires multi-level approval</p>
                                        </div>

                                        <h4 style="margin: 30px 0 15px 0; color: var(--text-primary);">Create Actions</h4>
                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Non-Production Environments</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowCreateNonProd" onchange="updateCreatePolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Allow resource creation in dev/staging</p>
                                        </div>

                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Production Environment</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowCreateProd" onchange="updateCreatePolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Requires DevOps approval</p>
                                        </div>

                                        <h4 style="margin: 30px 0 15px 0; color: var(--text-primary);">Admin Actions</h4>
                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Non-Production Environments</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowAdminNonProd" onchange="updateAdminPolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Allow admin-level permissions in dev/staging</p>
                                        </div>

                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Production Environment</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowAdminProd" onchange="updateAdminPolicy()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Requires CISO approval</p>
                                        </div>

                                        <div class="config-card">
                                            <div class="config-header">
                                                <h5>Sandbox Environment</h5>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="allowAdminSandbox" onchange="updateAdminPolicy()" checked>
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <p class="config-desc">Allow admin access in sandbox for testing</p>
                                        </div>

                                        <div class="contact-grid" style="margin-top: 30px;">
                                            <div class="contact-item">
                                                <label>Infrastructure Requests</label>
                                                <input type="email" id="emailCreateActions" value="devops@company.com" placeholder="team@company.com">
                                            </div>
                                            <div class="contact-item">
                                                <label>Delete Operations</label>
                                                <input type="email" id="emailDeleteActions" value="security@company.com" placeholder="team@company.com">
                                            </div>
                                            <div class="contact-item">
                                                <label>IAM & Security</label>
                                                <input type="email" id="emailIAMActions" value="security-team@company.com" placeholder="team@company.com">
                                            </div>
                                            <div class="contact-item">
                                                <label>Emergency Access</label>
                                                <input type="email" id="emailEmergency" value="ciso@company.com" placeholder="team@company.com">
                                            </div>
                                        </div>

                                        <button class="btn-primary" onclick="saveContactEmails()" style="margin-top: 20px;">Save Configuration</button>
                                    </div>
                                </div>
                            </div>

                            <div class="step-card" id="step5">
                                <div class="step-header" onclick="toggleStep('step5')">
                                    <span class="step-number">6</span>
                                    <h4>Test & Deploy</h4>
                                    <span class="step-status">ðŸš€ Ready</span>
                        </div>
                                <div class="step-content">
                                    <div class="deploy-section">
                                        <h5>Configuration Summary</h5>
                                        <div class="summary-box">
                                            <p>âœ“ 3 Groups configured (2 Permanent, 1 JIT)</p>
                                            <p>âœ“ 3 Access Levels defined (L1, L2, L3)</p>
                                            <p>âœ“ JIT enabled for Production accounts</p>
                                            <p>âœ“ 5 Approval rules configured</p>
                                        </div>
                                        <div style="margin-top: 20px;">
                                            <button class="btn-secondary" onclick="testConfiguration()">ðŸ§ª Test Configuration</button>
                                            <button class="btn-primary" onclick="deployConfiguration()">ðŸš€ Deploy to Production</button>
                                            <button class="btn-secondary" onclick="exportConfiguration()">ðŸ“¥ Export as JSON</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>

                </div>

                <!-- Admin Features Tab -->
                <div id="adminFeaturesTab" class="admin-tab" style="display: none; font-family: 'Inter', sans-serif;">
                    <div id="featuresSection" style="font-family: 'Inter', sans-serif;">
                        <div class="features-management">
                            <div class="section-header">
                                <h3><i class="fas fa-toggle-on"></i> Feature Management</h3>
                                <p style="color: #666; font-size: 13px;">Enable or disable features based on your license</p>
                            </div>

                            <div class="license-info" style="background: #e7f3ff; border: 1px solid #4A90E2; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
                                <h4 style="margin: 0 0 10px 0;">ðŸ“‹ Current License</h4>
                                <p style="margin: 5px 0;"><strong>Plan:</strong> Enterprise</p>
                                <p style="margin: 5px 0;"><strong>Users:</strong> 100 / Unlimited</p>
                                <p style="margin: 5px 0;"><strong>Expires:</strong> 2025-12-31</p>
                                <button class="btn-secondary btn-sm" onclick="alert('Contact sales@company.com to upgrade')">Upgrade License</button>
                            </div>

                            <div class="features-grid">
                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-hdd"></i> S3 Explorer</h4>
                                        <p>Browse and manage S3 buckets through web interface</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureS3" onchange="toggleFeature('s3', this.checked)" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-success">âœ“ Enabled</span>
                                    <span style="color: #666; font-size: 12px;">Included in license</span>
                                </div>
                    </div>
                    
                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-terminal"></i> Instance Terminal Access</h4>
                                        <p>SSH/SSM access to EC2 instances via browser</p>
                            </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureTerminal" onchange="toggleFeature('terminal', this.checked)" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                            </div>
                                <div class="feature-status">
                                    <span class="badge badge-success">âœ“ Enabled</span>
                                    <span style="color: #666; font-size: 12px;">Included in license</span>
                            </div>
                            </div>

                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-database"></i> Database Access Management</h4>
                                        <p>Manage temporary database credentials and connections</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureDatabase" onchange="toggleFeature('database', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-warning">âš  Disabled</span>
                                    <span style="color: #666; font-size: 12px;">Not in current license</span>
                        </div>
                    </div>
                    
                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-cube"></i> Container Access Management</h4>
                                        <p>Access Kubernetes pods and Docker containers</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureContainer" onchange="toggleFeature('container', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-warning">âš  Disabled</span>
                                    <span style="color: #666; font-size: 12px;">Not in current license</span>
                                </div>
                            </div>

                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-key"></i> Secrets Manager Access</h4>
                                        <p>Temporary access to secrets and credentials</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureSecrets" onchange="toggleFeature('secrets', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-warning">âš  Disabled</span>
                                    <span style="color: #666; font-size: 12px;">Not in current license</span>
                                </div>
                            </div>

                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-chart-line"></i> Advanced Analytics</h4>
                                        <p>Detailed reports and usage analytics</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureAnalytics" onchange="toggleFeature('analytics', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-warning">âš  Disabled</span>
                                    <span style="color: #666; font-size: 12px;">Premium feature</span>
                                </div>
                            </div>

                            <div class="feature-card">
                                <div class="feature-header">
                                    <div>
                                        <h4><i class="fas fa-brain"></i> Intelligent Permission Assistant</h4>
                                        <p>NPAMX-powered natural language understanding for permission requests</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="featureAI" onchange="toggleFeature('ai', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="feature-status">
                                    <span class="badge badge-warning">âš  Disabled</span>
                                    <span style="color: #666; font-size: 12px;">Premium feature</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Admin Integrations Tab -->
                <div id="adminIntegrationsTab" class="admin-tab" style="display: none;">
                    <div class="admin-integration-tabs">
                        <button class="admin-integration-tab-btn active" onclick="showAdminIntegrationCategory('cloud')"><i class="fas fa-cloud"></i> Cloud</button>
                        <button class="admin-integration-tab-btn" onclick="showAdminIntegrationCategory('identity')"><i class="fas fa-key"></i> Identity & Login</button>
                        <button class="admin-integration-tab-btn" onclick="showAdminIntegrationCategory('siem')"><i class="fas fa-shield-halved"></i> SIEM</button>
                        <button class="admin-integration-tab-btn" onclick="showAdminIntegrationCategory('ticketing')"><i class="fas fa-ticket-alt"></i> Ticketing</button>
                    </div>
                    
                    <!-- Cloud Integrations -->
                    <div id="adminIntegrationCloud" class="admin-integration-category active">
                        <div class="integrations-grid">
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-aws"><i class="fab fa-aws"></i></div>
                                    <h3>AWS</h3>
                                </div>
                                <p>Amazon Web Services</p>
                                <div class="integration-status connected"><i class="fas fa-check-circle"></i> Connected</div>
                                <button class="btn-secondary" onclick="configureIntegration('aws')"><i class="fas fa-cog"></i> Configure</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-gcp"><i class="fab fa-google"></i></div>
                                    <h3>GCP</h3>
                                </div>
                                <p>Google Cloud Platform</p>
                                <div class="integration-status connected"><i class="fas fa-check-circle"></i> Connected</div>
                                <button class="btn-secondary" onclick="configureIntegration('gcp')"><i class="fas fa-cog"></i> Configure</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Identity & Login Integrations -->
                    <div id="adminIntegrationIdentity" class="admin-integration-category">
                        <div class="integrations-grid">
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-okta"><i class="fas fa-key"></i></div>
                                    <h3>Okta</h3>
                                </div>
                                <p>SSO & Identity Management</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('okta')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-jumpcloud"><i class="fas fa-user-shield"></i></div>
                                    <h3>JumpCloud</h3>
                                </div>
                                <p>Directory-as-a-Service & SSO</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('jumpcloud')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-onelogin"><i class="fas fa-sign-in-alt"></i></div>
                                    <h3>OneLogin</h3>
                                </div>
                                <p>Unified Access Management</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('onelogin')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-azuread"><i class="fab fa-microsoft"></i></div>
                                    <h3>Azure AD</h3>
                                </div>
                                <p>Microsoft Entra ID</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('azuread')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-google"><i class="fab fa-google"></i></div>
                                    <h3>Google Workspace</h3>
                                </div>
                                <p>Google Identity & Directory</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('googleworkspace')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-ping"><i class="fas fa-fingerprint"></i></div>
                                    <h3>Ping Identity</h3>
                                </div>
                                <p>Enterprise Identity Platform</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('pingidentity')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-auth0"><i class="fas fa-lock"></i></div>
                                    <h3>Auth0</h3>
                                </div>
                                <p>Authentication & Authorization</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('auth0')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-duo"><i class="fas fa-shield-alt"></i></div>
                                    <h3>Duo Security</h3>
                                </div>
                                <p>MFA & Zero Trust Access</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('duo')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SIEM Integrations -->
                    <div id="adminIntegrationSiem" class="admin-integration-category">
                        <div class="integrations-grid">
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-splunk"><i class="fas fa-chart-line"></i></div>
                                    <h3>Splunk</h3>
                                </div>
                                <p>Log Analysis & SIEM Platform</p>
                                <div class="integration-status connected"><i class="fas fa-check-circle"></i> Connected</div>
                                <button class="btn-secondary" onclick="configureIntegration('splunk')"><i class="fas fa-cog"></i> Configure</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-sentinel"><i class="fab fa-microsoft"></i></div>
                                    <h3>Microsoft Sentinel</h3>
                                </div>
                                <p>Cloud-Native SIEM & SOAR</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('sentinel')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-chronicle"><i class="fab fa-google"></i></div>
                                    <h3>Google Chronicle</h3>
                                </div>
                                <p>Security Analytics & Detection</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('chronicle')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-qradar"><i class="fas fa-shield-halved"></i></div>
                                    <h3>IBM QRadar</h3>
                                </div>
                                <p>Enterprise SIEM & Threat Intelligence</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('qradar')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-elastic"><i class="fas fa-magnifying-glass"></i></div>
                                    <h3>Elastic Security</h3>
                                </div>
                                <p>SIEM & Endpoint Security</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('elastic')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-datadog"><i class="fas fa-chart-area"></i></div>
                                    <h3>Datadog</h3>
                                </div>
                                <p>Monitoring & Security Platform</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('datadog')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-wazuh"><i class="fas fa-shield-virus"></i></div>
                                    <h3>Wazuh</h3>
                                </div>
                                <p>Open Source SIEM & XDR</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('wazuh')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-crowdstrike"><i class="fas fa-shield-halved"></i></div>
                                    <h3>CrowdStrike</h3>
                                </div>
                                <p>Falcon XDR & Threat Intelligence</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('crowdstrike')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ticketing Integrations -->
                    <div id="adminIntegrationTicketing" class="admin-integration-category">
                        <div class="integrations-grid">
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-jira"><i class="fab fa-jira"></i></div>
                                    <h3>Jira</h3>
                                </div>
                                <p>Issue & Project Tracking (Atlassian)</p>
                                <div class="integration-status connected"><i class="fas fa-check-circle"></i> Connected</div>
                                <button class="btn-secondary" onclick="configureIntegration('jira')"><i class="fas fa-cog"></i> Configure</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-servicenow"><i class="fas fa-cogs"></i></div>
                                    <h3>ServiceNow</h3>
                                </div>
                                <p>IT Service Management Platform</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('servicenow')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-zendesk"><i class="fas fa-headset"></i></div>
                                    <h3>Zendesk</h3>
                                </div>
                                <p>Customer Support & Ticketing</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('zendesk')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-freshdesk"><i class="fas fa-life-ring"></i></div>
                                    <h3>Freshdesk</h3>
                                </div>
                                <p>Help Desk & Ticketing</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('freshdesk')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-pagerduty"><i class="fas fa-bell"></i></div>
                                    <h3>PagerDuty</h3>
                                </div>
                                <p>Incident Management & On-Call</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('pagerduty')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-opsgenie"><i class="fas fa-bolt"></i></div>
                                    <h3>Opsgenie</h3>
                                </div>
                                <p>Alerting & Incident Response (Atlassian)</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('opsgenie')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-zoho"><i class="fas fa-comments"></i></div>
                                    <h3>Zoho Desk</h3>
                                </div>
                                <p>Customer Support Suite</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('zohodesk')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                            <div class="integration-card">
                                <div class="integration-header">
                                    <div class="integration-logo-icon integration-logo-confluence"><i class="fab fa-confluence"></i></div>
                                    <h3>Confluence</h3>
                                </div>
                                <p>Documentation & Knowledge Base</p>
                                <div class="integration-status disconnected"><i class="fas fa-times-circle"></i> Not Connected</div>
                                <button class="btn-primary" onclick="configureIntegration('confluence')"><i class="fas fa-plug"></i> Connect</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Security Tab -->
                <div id="adminSecurityTab" class="admin-tab" style="display: none;">
                    <!-- Sub-tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px;">
                        <button class="tab-glow-subtab tab-glow-subtab-active" id="securitySubTab" onclick="showSecuritySubTab('security')">
                            <i class="fas fa-shield-alt"></i> Security
                        </button>
                        <button class="tab-glow-subtab" id="guardrailsSubTab" onclick="showSecuritySubTab('guardrails')">
                            <i class="fas fa-shield-check"></i> Guardrails
                        </button>
                        <button class="tab-glow-subtab" id="auditSubTab" onclick="showSecuritySubTab('audit')">
                            <i class="fas fa-clipboard-list"></i> Audit Logs
                        </button>
                    </div>

                    <!-- Security Section -->
                    <div id="securitySection" style="display: block !important; visibility: visible !important; min-height: 500px !important;">
                    <div class="security-management" style="display: block !important; visibility: visible !important; min-height: 400px !important; padding: 20px !important;">
                        <div class="section-header" style="display: block !important; min-height: 50px !important;">
                            <h3 style="display: block !important; min-height: 30px !important; line-height: 30px !important;"><i class="fas fa-shield-alt"></i> Security Configuration</h3>
                        </div>

                        <!-- Blocked IPs -->
                        <div class="config-section" style="margin-bottom: 30px;">
                            <div class="section-header">
                                <h4>Blocked IP Addresses</h4>
                                <button class="btn-primary btn-sm" onclick="addBlockedIP()">
                                    <i class="fas fa-plus"></i> Add IP
                                </button>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 15px;">Block specific IP addresses or ranges from accessing the JIT portal</p>
                            <div id="blockedIPsList" style="display: flex; flex-direction: column; gap: 10px;">
                                <div class="ip-item">
                                    <input type="text" value="192.168.1.100" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                    <input type="text" value="Suspicious activity" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                    <button class="btn-danger btn-sm" onclick="removeBlockedIP(this)"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>

                        <!-- Allowed IPs -->
                        <div class="config-section">
                            <div class="section-header">
                                <h4>Allowed IP Addresses (Whitelist)</h4>
                                <button class="btn-primary btn-sm" onclick="addAllowedIP()">
                                    <i class="fas fa-plus"></i> Add IP
                                </button>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 15px;">Restrict JIT portal access to specific internal IP addresses or ranges. Leave empty to allow all IPs.</p>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableIPWhitelist" onchange="toggleIPWhitelist()">
                                    Enable IP Whitelist (Only allow access from specified IPs)
                                </label>
                            </div>
                            <div id="allowedIPsList" style="display: none; flex-direction: column; gap: 10px; margin-top: 15px;">
                                <div class="ip-item">
                                    <input type="text" value="10.0.0.0/8" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                    <input type="text" value="Internal network" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                    <button class="btn-danger btn-sm" onclick="removeAllowedIP(this)"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>

                        <button class="btn-primary" onclick="saveSecurityConfig()" style="margin-top: 30px;">
                            <i class="fas fa-save"></i> Save Security Configuration
                        </button>
                    </div>
                    </div>

                    <!-- Guardrails Section -->
                    <div id="guardrailsSection" style="display: none;">
                        <div class="guardrails-management">
                            <div class="section-header">
                                <h3><i class="fas fa-shield-check"></i> Access Guardrails</h3>
                                <p style="color: var(--text-secondary); font-size: 13px; margin-top: 5px;">Define security guardrails to control what services and operations users can request</p>
                            </div>

                            <!-- AI Guardrail Generator -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin-bottom: 30px; color: white;">
                                <h4 style="margin: 0 0 10px 0; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-robot" style="font-size: 24px;"></i>
                                    NPAMX Guardrail Generator
                                </h4>
                                <p style="margin: 0 0 15px 0; font-size: 13px; opacity: 0.9;">Describe your security requirements in natural language, and AI will generate appropriate guardrails</p>
                                <div style="display: flex; gap: 10px;">
                                    <textarea id="aiGuardrailInput" placeholder="Example: Block all delete operations on production KMS keys and Secrets Manager" rows="2" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 13px; resize: none;"></textarea>
                                    <button onclick="generateAIGuardrail()" class="btn-primary" style="padding: 12px 24px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                        <i class="fas fa-magic"></i> Generate
                                </button>
                            </div>
                                <small style="display: block; margin-top: 10px; opacity: 0.8;"><i class="fas fa-lock"></i> MFA verification required for AI-generated guardrails</small>
                            </div>

                            <!-- Guardrail Type 1: Service Access Control -->
                            <div class="guardrail-card" style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: var(--text-primary); font-size: 15px;">
                                            <i class="fas fa-ban" style="color: #f44336;"></i> Service Access Restrictions
                                        </h4>
                                        <p style="margin: 0; color: var(--text-secondary); font-size: 12px;">Control which AWS services users can request access to</p>
                                    </div>
                                    <button onclick="addServiceRestriction()" class="btn-primary btn-sm" style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-plus"></i> Add Rule
                                    </button>
                                </div>
                                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 12px;">
                                    <strong><i class="fas fa-info-circle"></i> Guidelines:</strong> Sensitive services like KMS (encryption keys) and Secrets Manager contain critical credentials and encryption keys. Restrict access to authorized personnel only.
                                </div>
                                <div id="serviceRestrictionsList" style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="restriction-item" style="display: flex; gap: 10px; align-items: center; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px;">
                                        <select style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="kms">KMS (Key Management Service)</option>
                                            <option value="secretsmanager">Secrets Manager</option>
                                            <option value="iam">IAM (Identity & Access Management)</option>
                                            <option value="organizations">AWS Organizations</option>
                                            <option value="billing">Billing & Cost Management</option>
                                        </select>
                                        <select style="flex: 0 0 150px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="block">Block All Access</option>
                                            <option value="read_only">Read-Only</option>
                                            <option value="approval">Require Approval</option>
                                        </select>
                                        <input type="text" placeholder="Reason" value="Sensitive encryption keys" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                        <button class="btn-danger btn-sm" onclick="removeRestriction(this)"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Guardrail Type 2: Delete Operation Restrictions -->
                            <div class="guardrail-card" style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: var(--text-primary); font-size: 15px;">
                                            <i class="fas fa-trash-alt" style="color: #f44336;"></i> Delete Operation Restrictions
                                        </h4>
                                        <p style="margin: 0; color: var(--text-secondary); font-size: 12px;">Block delete permissions for specific services to prevent accidental data loss</p>
                                    </div>
                                    <button onclick="addDeleteRestriction()" class="btn-primary btn-sm" style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-plus"></i> Add Rule
                                    </button>
                                </div>
                                <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 12px;">
                                    <strong><i class="fas fa-exclamation-triangle"></i> Warning:</strong> Delete operations are irreversible. Consider blocking delete permissions for production databases, S3 buckets with critical data, and KMS keys.
                                </div>
                                <div id="deleteRestrictionsList" style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="restriction-item" style="display: flex; gap: 10px; align-items: center; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px;">
                                        <select style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="kms">KMS Keys</option>
                                            <option value="s3">S3 Buckets</option>
                                            <option value="rds">RDS Databases</option>
                                            <option value="dynamodb">DynamoDB Tables</option>
                                            <option value="ec2">EC2 Instances</option>
                                            <option value="lambda">Lambda Functions</option>
                                        </select>
                                        <select style="flex: 0 0 150px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="all">All Environments</option>
                                            <option value="prod">Production Only</option>
                                            <option value="nonprod">Non-Prod Only</option>
                                        </select>
                                        <input type="text" placeholder="Reason" value="Prevent accidental deletion" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                        <button class="btn-danger btn-sm" onclick="removeRestriction(this)"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Guardrail Type 3: Create Operation Restrictions -->
                            <div class="guardrail-card" style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: var(--text-primary); font-size: 15px;">
                                            <i class="fas fa-plus-circle" style="color: #ff9800;"></i> Create Operation Restrictions
                                        </h4>
                                        <p style="margin: 0; color: var(--text-secondary); font-size: 12px;">Control which services users can create new resources in</p>
                                    </div>
                                    <button onclick="addCreateRestriction()" class="btn-primary btn-sm" style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-plus"></i> Add Rule
                                    </button>
                                </div>
                                <div style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 12px;">
                                    <strong><i class="fas fa-info-circle"></i> Best Practice:</strong> Resource creation should go through proper change management. Block create permissions and route requests to DevOps/Infrastructure team.
                                </div>
                                <div id="createRestrictionsList" style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="restriction-item" style="display: flex; gap: 10px; align-items: center; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px;">
                                        <select style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="ec2">EC2 Instances</option>
                                            <option value="rds">RDS Databases</option>
                                            <option value="s3">S3 Buckets</option>
                                            <option value="vpc">VPC Resources</option>
                                            <option value="iam">IAM Users/Roles</option>
                                            <option value="kms">KMS Keys</option>
                                        </select>
                                        <select style="flex: 0 0 150px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="all">All Environments</option>
                                            <option value="prod">Production Only</option>
                                            <option value="nonprod">Non-Prod Only</option>
                                        </select>
                                        <input type="text" placeholder="Reason" value="Route to DevOps team" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                        <button class="btn-danger btn-sm" onclick="removeRestriction(this)"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Guardrail Type 4: Custom Guardrails -->
                            <div class="guardrail-card" style="background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: var(--text-primary); font-size: 15px;">
                                            <i class="fas fa-cogs" style="color: #2196F3;"></i> Custom Guardrails
                                        </h4>
                                        <p style="margin: 0; color: var(--text-secondary); font-size: 12px;">Define custom rules based on tags, resource names, or specific conditions</p>
                                    </div>
                                    <button onclick="addCustomGuardrail()" class="btn-primary btn-sm" style="padding: 6px 12px; font-size: 12px;">
                                        <i class="fas fa-plus"></i> Add Rule
                                    </button>
                                </div>
                                <div id="customGuardrailsList" style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="restriction-item" style="display: flex; gap: 10px; align-items: center; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px;">
                                        <input type="text" placeholder="Rule Name" value="Block prod-* tagged resources" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                        <select style="flex: 0 0 120px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="tag">Tag-based</option>
                                            <option value="name">Name pattern</option>
                                            <option value="arn">ARN pattern</option>
                                        </select>
                                        <input type="text" placeholder="Condition" value="Environment=production" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary);">
                                        <button class="btn-danger btn-sm" onclick="removeRestriction(this)"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Button -->
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                                <button onclick="previewGuardrails()" class="btn-secondary" style="padding: 12px 24px;">
                                    <i class="fas fa-eye"></i> Preview Impact
                                </button>
                                <button onclick="saveGuardrails()" class="btn-primary" style="padding: 12px 24px;">
                                    <i class="fas fa-save"></i> Save Guardrails
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Section -->
                    <div id="auditSection" style="display: none;">
                    <div class="audit-logs">
                        <div class="audit-header">
                            <h3>Audit Logs</h3>
                            <div class="audit-filters">
                                <select id="auditFilter">
                                    <option value="all">All Events</option>
                                    <option value="login">Login Events</option>
                                    <option value="request">Access Requests</option>
                                    <option value="approval">Approvals</option>
                                    <option value="revoke">Revocations</option>
                                </select>
                                <input type="date" id="auditDateFrom" placeholder="From Date">
                                <input type="date" id="auditDateTo" placeholder="To Date">
                                <button class="btn-secondary" onclick="filterAuditLogs()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="audit-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>User</th>
                                        <th>Event</th>
                                        <th>Resource</th>
                                        <th>IP Address</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="auditLogsTableBody">
                                    <!-- Audit logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
            </div>
            </div>

                <!-- Admin Reports & Audit Tab -->
                <div id="adminReportsTab" class="admin-tab" style="display: none;">
                    <div class="admin-reports-audit">
                        <div class="reports-audit-tabs" style="display: flex; gap: 10px; margin-bottom: 24px; border-bottom: 2px solid var(--border-color); padding-bottom: 12px;">
                            <button class="tab-glow-subtab tab-glow-subtab-active" onclick="showReportsAuditSubTab('reports', event)">
                                <i class="fas fa-chart-bar"></i> Reports & Analytics
                            </button>
                            <button class="tab-glow-subtab" onclick="showReportsAuditSubTab('audit', event)">
                                <i class="fas fa-clipboard-list"></i> Audit Logs
                            </button>
                        </div>
                        <div id="adminReportsContent" class="reports-content">
                            <div class="reports-placeholder" style="text-align: center; padding: 60px 20px; background: var(--bg-card); border-radius: 12px; border: 1px dashed var(--border-color);">
                                <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--primary); margin-bottom: 16px;"></i>
                                <h3>Access Reports & Analytics</h3>
                                <p style="color: var(--text-secondary); margin-top: 8px;">View detailed reports on access patterns, trends, and compliance metrics</p>
                            </div>
                        </div>
                        <div id="adminAuditContent" class="audit-content" style="display: none;">
                            <div class="audit-logs">
                                <div class="audit-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h3><i class="fas fa-clipboard-list"></i> Audit Logs</h3>
                                    <div class="audit-filters" style="display: flex; gap: 10px;">
                                        <select id="adminAuditFilter" style="padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-secondary);">
                                            <option value="all">All Events</option>
                                            <option value="login">Login Events</option>
                                            <option value="request">Access Requests</option>
                                            <option value="approval">Approvals</option>
                                            <option value="revoke">Revocations</option>
                                        </select>
                                        <input type="date" id="adminAuditDateFrom" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border-color);">
                                        <input type="date" id="adminAuditDateTo" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border-color);">
                                        <button class="btn-secondary" onclick="filterAdminAuditLogs()"><i class="fas fa-filter"></i> Filter</button>
                                    </div>
                                </div>
                                <div class="audit-table">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr>
                                                <th>Timestamp</th>
                                                <th>User</th>
                                                <th>Event</th>
                                                <th>Resource</th>
                                                <th>IP Address</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminAuditLogsTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <!-- Request for Others Page -->
            <div id="requestForOthersPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-user-plus"></i> Request Access for Others</h2>
                    <button class="btn-secondary" onclick="cancelRequestForOthers()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
                
                <div id="othersStep1" class="request-wizard-step">
                    <h3 style="font-family: 'Inter', sans-serif; font-size: 18px; margin-bottom: 20px; color: var(--text-primary);">What do you want to request access for?</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 800px;">
                        <div class="cloud-choice-card" onclick="selectCloudProviderForOthers('aws')">
                            <img src="assets/logos/aws.png" alt="AWS" class="card-logo">
                            <h4>AWS</h4>
                        </div>
                        <div class="cloud-choice-card" onclick="selectCloudProviderForOthers('gcp')">
                            <img src="assets/logos/gcp.png" alt="GCP" class="card-logo">
                            <h4>GCP</h4>
                        </div>
                    </div>
                </div>

                <div id="othersStep2AWS" class="request-wizard-step" style="display: none;">
                    <button class="btn-secondary" onclick="backToOthersStep1()" style="margin-bottom: 20px;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    
                    <div style="display: flex; gap: 20px;">
                        <form id="requestForOthersForm" style="flex: 0 0 450px; max-width: 450px;">
                            <div class="form-group">
                                <label>Requester Email(s) *</label>
                                <div class="email-tags-container" style="display: flex; flex-wrap: wrap; gap: 5px; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-primary);">
                                    <div id="othersEmailTags" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                                    <input type="text" id="othersEmailInput" placeholder="Type email and press Tab" style="border: none; outline: none; flex: 1; min-width: 200px; background: transparent; color: var(--text-primary);">
                                </div>
                                <small>Press Tab or Enter to add multiple emails</small>
                            </div>

                            <div class="form-group">
                                <label>Select AWS Account *</label>
                                <select id="othersRequestAccount" required onchange="fetchAWSResourcesForOthers()">
                                    <option value="">Select Account</option>
                                </select>
                            </div>

                            <div id="othersResourceExplorerSection" style="display: none;">
                                <div class="form-group">
                                    <label>Available AWS Services</label>
                                    <div id="othersResourceExplorerLoading" style="display: none; text-align: center; padding: 20px;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #667eea;"></i>
                                        <p style="margin-top: 10px; color: var(--text-secondary); font-size: 14px;">Fetching resources from AWS...</p>
                                    </div>
                                    <div id="othersAWSServicesList" style="display: none;"></div>
                                </div>

                                <div class="form-group" id="othersMyResourcesSection" style="display: none;">
                                    <label>Selected Resources</label>
                                    <div id="othersMyResourcesList" class="resources-list"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Duration</label>
                                <select id="othersRequestDuration">
                                    <option value="4">4 hours</option>
                                    <option value="8" selected>8 hours</option>
                                    <option value="24">24 hours</option>
                                    <option value="72">3 days</option>
                                    <option value="120">5 days (max)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Business Justification *</label>
                                <textarea id="othersRequestJustification" placeholder="Explain why this access is needed" rows="3" required></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="button" class="btn-secondary" onclick="cancelRequestForOthers()">Cancel</button>
                                <button type="submit" class="btn-primary">Submit Request</button>
                            </div>
                        </form>
                        
                        <div style="flex: 0 0 280px;">
                            <div style="position: sticky; top: 20px; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--text-primary); font-family: 'Inter', sans-serif; font-weight: 600;">Selected Resources</h4>
                                <div id="othersSelectedResourcesPanel" style="max-height: 400px; overflow-y: auto;">
                                    <p style="color: var(--text-secondary); font-size: 12px;">No resources selected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay">
        <!-- Profile Modal -->
        <div id="profileModal" class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> My Profile</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-info">
                    <div class="profile-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="profile-details">
                        <h4>Satish Korra</h4>
                        <p>Satish.Korra@nykaa.com</p>
                        <p>Senior DevOps Engineer</p>
                    </div>
                </div>
                <div class="theme-settings">
                    <h4>Theme Settings</h4>
                    <div class="theme-options">
                        <button class="theme-option active" onclick="setTheme('light')">
                            <i class="fas fa-sun"></i> Light
                        </button>
                        <button class="theme-option" onclick="setTheme('dark')">
                            <i class="fas fa-moon"></i> Dark
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create User Modal -->
        <div id="createUserModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-user-plus"></i> Add User</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createUserForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" id="userFirstName" required placeholder="John">
                    </div>
                    <div class="form-group">
                        <label>Middle Name</label>
                        <input type="text" id="userMiddleName" placeholder="M">
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" id="userLastName" required placeholder="Doe">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email Address <span class="required">*</span></label>
                    <input type="email" id="userEmail" required placeholder="john.doe@company.com">
                </div>
                <div class="form-group">
                    <label>Role <span class="required">*</span></label>
                    <select id="userRole" required>
                        <option value="">Select Role</option>
                        <option value="ReadOnly">ReadOnly</option>
                        <option value="Manager">Manager</option>
                        <option value="Admin">Admin</option>
                    </select>
                    <small class="form-hint">ReadOnly: View only | Manager: Approve requests, manage access | Admin: Full control</small>
                </div>
                <div class="form-group">
                    <label>Add to Group</label>
                    <select id="userGroup">
                        <option value="">Select Group (optional)</option>
                        <!-- Populated by populateGroupDropdown() -->
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create User</button>
                </div>
            </form>
        </div>
        </div>

        <!-- Assign Users to Group Modal (Access groups: ReadOnly, Manager, Admin) -->
        <div id="createGroupModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-users-cog"></i> Assign Users to Group</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createGroupForm">
                <div class="form-group">
                    <label>Group <span class="required">*</span></label>
                    <select id="groupName" required>
                        <option value="">Select Group</option>
                        <option value="ReadOnly">ReadOnly</option>
                        <option value="Manager">Manager</option>
                        <option value="Admin">Admin</option>
                    </select>
                    <small class="form-hint">Access groups define who can use the JIT tool and at what level</small>
                </div>
                <div class="form-group">
                    <label>Add Users to Group</label>
                    <div id="groupUsersList" class="users-checklist">
                        <p class="text-muted">Loading users...</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Assign to Group</button>
                </div>
            </form>
        </div>
        </div>
    </div>

    <!-- Manual Onboard Modal -->
    <div id="manualOnboardModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-user-plus"></i> Manual User Onboarding</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="manualOnboardForm">
                <div class="form-group">
                    <label>Email Address <span class="required">*</span></label>
                    <input type="email" id="onboardEmail" required placeholder="user@nykaa.com">
                </div>
                <div class="form-group">
                    <label>Full Name <span class="required">*</span></label>
                    <input type="text" id="onboardName" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="onboardDepartment">
                        <option value="">Select Department</option>
                        <option value="engineering">Engineering</option>
                        <option value="devops">DevOps</option>
                        <option value="security">Security</option>
                        <option value="qa">Quality Assurance</option>
                        <option value="product">Product</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Temporary Password <span class="required">*</span></label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="password" id="onboardPassword" required style="flex: 1;">
                        <button type="button" class="btn-secondary" onclick="generateTempPassword()">Generate</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableMFA" checked>
                        Enable MFA (Recommended)
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Onboard User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Application Request Modal -->
    <div id="appRequestModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-apps"></i> Application Access Request</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="appRequestForm">
                <div class="form-group">
                    <label>Application Type <span class="required">*</span></label>
                    <select id="appType" required>
                        <option value="">Select Application Type</option>
                        <option value="cloud">Cloud Platform</option>
                        <option value="kubernetes">Kubernetes</option>
                        <option value="database">Database</option>
                        <option value="application">Application</option>
                        <option value="ticketing">Ticketing System</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Specific Application <span class="required">*</span></label>
                    <select id="specificApp" required>
                        <option value="">Select Application</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Access Level <span class="required">*</span></label>
                    <select id="appAccessLevel" required>
                        <option value="read">Read Only</option>
                        <option value="write">Read/Write</option>
                        <option value="admin">Admin (Requires Approval)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duration <span class="required">*</span></label>
                    <select id="appRequestDuration" required>
                        <option value="1">1 Hour</option>
                        <option value="4">4 Hours</option>
                        <option value="8" selected>8 Hours</option>
                        <option value="24">1 Day</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Business Justification <span class="required">*</span></label>
                    <textarea id="appRequestJustification" required rows="3" placeholder="Explain why this access is needed..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cloud Onboarding Modal -->
    <div id="cloudOnboardingModal" class="modal">
        <div class="modal-header">
            <h3><img src="assets/logos/aws.png" alt="" class="page-title-logo"> Cloud Onboarding</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="cloud-onboard-grid">
                <button class="cloud-onboard-btn" onclick="onboardCloud('aws')">
                    <img src="assets/logos/aws.png" alt="AWS" class="card-logo">
                </button>
                <button class="cloud-onboard-btn" onclick="onboardCloud('gcp')">
                    <img src="assets/logos/gcp.png" alt="GCP" class="card-logo">
                </button>
            </div>
        </div>
    </div>

    <!-- Security Copilot (inside mainApp - hidden on login page) -->
    <div id="securityCopilotButton" class="security-copilot-button" onclick="toggleSecurityCopilot()">
        <div class="copilot-icon">
            <i class="fas fa-robot"></i>
        </div>
        <span class="copilot-label">NPAMX</span>
    </div>
    <div id="securityCopilotPopup" class="security-copilot-popup">
        <div class="copilot-header">
            <div class="copilot-header-content">
                <div class="copilot-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="copilot-header-text">
                    <h4>NPAMX</h4>
                    <p>Your AI security assistant</p>
                </div>
            </div>
            <button class="copilot-close" onclick="toggleSecurityCopilot()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="copilot-messages" id="copilotMessages">
            <div class="copilot-message assistant">
                <div class="message-content">
                    <p>Hello! I'm NPAMX. I can help you:</p>
                    <ul>
                        <li>Explain access decisions</li>
                        <li>Understand risk scores</li>
                        <li>Clarify policies</li>
                        <li>Review audit logs</li>
                    </ul>
                    <p>What would you like to know?</p>
                </div>
            </div>
        </div>
        <div class="copilot-input-area">
            <input type="text" id="copilotInput" class="copilot-input" placeholder="Ask about access decisions, policies, or risk scores..." onkeydown="if(event.key==='Enter') sendCopilotMessage()">
            <button class="copilot-send" onclick="sendCopilotMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

            <!-- Request for Others Page -->
            </div>

    <!-- Chart.js, xterm: loaded on-demand (dashboard / SSH terminal) -->
    <script src="bundle.js?v=15"></script>
    <script>
        // Initialize unified assistant when requests page loads (only when logged in)
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('isLoggedIn') !== 'true') return;
            setTimeout(function() {
                if (typeof initUnifiedAssistant === 'function') initUnifiedAssistant();
            }, 500);
        });
        
        // Auto logout after 30 minutes of inactivity
        let inactivityTimer;
        const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30 minutes
        
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                alert('Session expired due to inactivity. You will be logged out.');
                logout();
            }, INACTIVITY_TIMEOUT);
        }
        
        // Track user activity (debounce scroll/mousemove to avoid UI jank)
        let activityDebounce;
        function debouncedReset() {
            if (activityDebounce) clearTimeout(activityDebounce);
            activityDebounce = setTimeout(resetInactivityTimer, 80);
        }
        document.addEventListener('mousedown', resetInactivityTimer);
        document.addEventListener('mousemove', debouncedReset);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('scroll', function() { debouncedReset(); }, { passive: true });
        document.addEventListener('touchstart', resetInactivityTimer);
        
        // Start timer on page load
        resetInactivityTimer();
        
        // Sub-tab switching functions
        function showUsersSubTab(tab) {
            document.getElementById('usersSection').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('groupsSection').style.display = tab === 'groups' ? 'block' : 'none';
            
            const usersBtn = document.getElementById('usersSubTab');
            const groupsBtn = document.getElementById('groupsSubTab');
            
            if (tab === 'users') {
                usersBtn.classList.add('user-mgmt-subtab-active');
                groupsBtn.classList.remove('user-mgmt-subtab-active');
            } else {
                groupsBtn.classList.add('user-mgmt-subtab-active');
                usersBtn.classList.remove('user-mgmt-subtab-active');
            }
        }
        
        function showManagementSubTab(tab) {
            document.getElementById('policiesSection').style.display = tab === 'policies' ? 'block' : 'none';
            document.getElementById('featuresSection').style.display = tab === 'features' ? 'block' : 'none';
            
            const policiesBtn = document.getElementById('policiesSubTab');
            const featuresBtn = document.getElementById('featuresSubTab');
            
            if (tab === 'policies') {
                policiesBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                policiesBtn.style.color = 'white';
                policiesBtn.style.border = 'none';
                featuresBtn.style.background = 'var(--bg-secondary)';
                featuresBtn.style.color = 'var(--text-primary)';
                featuresBtn.style.border = '1.5px solid var(--border-color)';
            } else {
                featuresBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                featuresBtn.style.color = 'white';
                featuresBtn.style.border = 'none';
                policiesBtn.style.background = 'var(--bg-secondary)';
                policiesBtn.style.color = 'var(--text-primary)';
                policiesBtn.style.border = '1.5px solid var(--border-color)';
            }
        }
        
        function showSecuritySubTab(tab) {
            document.getElementById('securitySection').style.display = tab === 'security' ? 'block' : 'none';
            document.getElementById('guardrailsSection').style.display = tab === 'guardrails' ? 'block' : 'none';
            document.getElementById('auditSection').style.display = tab === 'audit' ? 'block' : 'none';
            
            const securityBtn = document.getElementById('securitySubTab');
            const guardrailsBtn = document.getElementById('guardrailsSubTab');
            const auditBtn = document.getElementById('auditSubTab');
            
            [securityBtn, guardrailsBtn, auditBtn].forEach(btn => {
                btn.classList.remove('tab-glow-subtab-active');
            });
            const activeBtn = tab === 'security' ? securityBtn : (tab === 'guardrails' ? guardrailsBtn : auditBtn);
            if (activeBtn) activeBtn.classList.add('tab-glow-subtab-active');
        }
            
        // Security Copilot Functions
        function toggleSecurityCopilot() {
            const popup = document.getElementById('securityCopilotPopup');
            if (popup) {
                popup.classList.toggle('show');
            }
        }
        
        function sendCopilotMessage() {
            const input = document.getElementById('copilotInput');
            const messages = document.getElementById('copilotMessages');
            if (!input || !messages) return;
            
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            messages.innerHTML += `
                <div class="copilot-message user">
                    <div class="message-content">${message}</div>
                </div>
            `;
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
            
            // Simulate AI response (replace with actual API call)
                setTimeout(() => {
                messages.innerHTML += `
                    <div class="copilot-message assistant">
                        <div class="message-content">
                            <p>I understand you're asking about: "${message}"</p>
                            <p>This feature is connected to NPAMX. For detailed help, please use NPAMX on the Requests page.</p>
                        </div>
                    </div>
                `;
                messages.scrollTop = messages.scrollHeight;
            }, 500);
        }
    </script>
</body>
</html>
