<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Portal - JIT Access Request</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="enterprise-theme.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <link href="design-system.css" rel="stylesheet">
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div id="emailOTPView">
                <div class="login-header">
                    <h2>JIT Access Portal</h2>
                    <p>Sign in to use the same portal: Dashboard, My Requests, Instances, S3, Databases, and more. (Admin-only areas are hidden for you.)</p>
                </div>
                
                <form id="emailOTPForm" class="login-form">
                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="emailOTP" placeholder="Enter your work email" required>
                    </div>
                    <button type="submit" class="btn-primary">Continue</button>
                </form>
                
                <div class="divider"><span>Or</span></div>
                
                <div class="alt-login-options">
                    <button type="button" class="alt-login-btn" onclick="showPasswordLogin()">Login with Password</button>
                </div>
            </div>

            <div id="passwordLoginView" style="display: none;">
                <button type="button" class="back-btn" onclick="showEmailLogin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="login-header">
                    <h2>Login with Password</h2>
                    <p>Enter your credentials to continue.</p>
                </div>
                
                <form id="usernamePasswordForm" class="login-form">
                    <div class="form-group">
                        <label>Email or Username <span class="required">*</span></label>
                        <input type="text" id="username" placeholder="Enter Email or Username" required>
                    </div>
                    <div class="form-group">
                        <label>Password <span class="required">*</span></label>
                        <input type="password" id="password" placeholder="Enter Password" required>
                    </div>
                    <button type="submit" class="btn-primary">Sign In</button>
                </form>
            </div>

            <div id="otpVerifyView" style="display: none;">
                <button type="button" class="back-btn" onclick="showEmailLogin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="otp-header">
                    <i class="fas fa-mobile-alt"></i>
                    <h3>Verify One-Time Passcode</h3>
                    <p>Enter the 6-digit code sent to <strong id="otpEmail"></strong></p>
                </div>
                
                <form id="otpVerifyForm" class="login-form">
                    <div class="otp-inputs" id="otpInputsContainer">
                        <input type="text" maxlength="1" class="otp-input" id="otp1" inputmode="numeric" autocomplete="one-time-code">
                        <input type="text" maxlength="1" class="otp-input" id="otp2" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp3" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp4" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp5" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp6" inputmode="numeric">
                    </div>
                    <small class="input-hint" style="display: block; margin-top: 8px; color: var(--text-secondary);">Demo: enter or paste 123456</small>
                    <button type="submit" class="btn-primary">Verify & Continue</button>
                </form>
            </div>

            <div class="login-footer" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center;">
                <a href="index.html" style="color: var(--text-secondary); font-size: 13px;">Admin? Sign in here</a>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        document.getElementById('emailOTPForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('emailOTP').value.trim();
            if (email) {
                document.getElementById('otpEmail').textContent = email;
                alert('OTP sent to ' + email + ' (demo mode)');
                document.getElementById('emailOTPView').style.display = 'none';
                document.getElementById('otpVerifyView').style.display = 'block';
            }
        });

        document.getElementById('otpVerifyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const otp = [1,2,3,4,5,6].map(i => document.getElementById('otp'+i).value).join('');
            if (otp.length === 6) {
                const email = document.getElementById('otpEmail').textContent.trim();
                if (email) {
                    doUserLogin(email);
                } else {
                    alert('Session expired. Please go back and enter your email again.');
                }
            } else {
                alert('Please enter all 6 digits. Demo: use 123456');
            }
        });

        // Paste support: paste "123456" distributes across all 6 boxes
        document.getElementById('otpInputsContainer').addEventListener('paste', function(e) {
            e.preventDefault();
            const pasted = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').slice(0, 6);
            for (let i = 0; i < 6; i++) {
                const el = document.getElementById('otp' + (i + 1));
                if (el) el.value = pasted[i] || '';
            }
            if (pasted.length === 6) document.getElementById('otp6').focus();
        });

        document.getElementById('usernamePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            if (username && password) {
                doUserLogin(username.includes('@') ? username : username + '@company.com');
            }
        });

        function showPasswordLogin() {
            document.getElementById('emailOTPView').style.display = 'none';
            document.getElementById('passwordLoginView').style.display = 'block';
        }

        function showEmailLogin() {
            document.getElementById('passwordLoginView').style.display = 'none';
            document.getElementById('otpVerifyView').style.display = 'none';
            document.getElementById('emailOTPView').style.display = 'block';
        }

        function doUserLogin(email) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userEmail', email);
            localStorage.setItem('isAdmin', 'false');
            localStorage.setItem('userRole', 'user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
